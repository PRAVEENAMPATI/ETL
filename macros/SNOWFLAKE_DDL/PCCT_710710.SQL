{% macro PCCT_710710() -%}
 {################# Step 1 DECLARE SCRIPTS/DDL NEED TO EXECUTED #################}
{%- set v_scripts -%} 

CREATE OR REPLACE TABLE {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_NPD.PROJECTS_TASK_RPT_PV20230322 CLONE 
 {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_NPD.PROJECTS_TASK_RPT;

DROP TABLE {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_NPD.PROJECTS_TASK_RPT;

CREATE TABLE {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_NPD.PROJECTS_TASK_RPT AS
SELECT 
MSPROJECT_TASK_KEY,
SNAPSHOT_WEEK_KEY,
PROJECT_NUMBER,
PROJECT_ID,
PROJECT_NAME,
PROJECT_OWNER,
PROJECT_INTERNAL_URL,
TASK_ID,    
TASK_NAME,
TASK_OWNER,
TASK_START_DATE,
TASK_FINISH_DATE,
TASK_ACTUAL_START_DATE,
TASK_ACTUAL_FINISH_DATE,
TASK_LATE_START,
TASK_LATE_FINISH,
TASK_PERCENT_COMPLETED,
IS_PAST_DUE,
IS_DUE_IN_NEXT_7DAYS,
TASK_CREATED_DATE,
'0'::NUMBER AS TASKOUTLINELEVEL,
'N'::BOOLEAN AS TASKISSUMMARY,
'N'::BOOLEAN AS TASKISMILESTONE,
'0'::NUMBER AS TASKPERCENTCOMPLETED,
'0.0'::NUMBER(28,6) AS TASKDURATION, 
BIW_INS_DTTM,
BIW_UPD_DTTM,
BIW_BATCH_ID,
'N'::BOOLEAN AS BIW_LOGICAL_DELETE_FLAG,
BIW_MD5_KEY
FROM {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_NPD.PROJECTS_TASK_RPT_PV20230322;

{%endset%}

{################# Step 2 EXECUTE SCRIPTS #################}
{% do run_query(v_scripts) %}

{################# Step 3 CAPTURE INTO DBT TABLE #################}
Insert into var('V_EDL_DEFAULT_DB')+env_var('DBT_DEP_ENV').UTILITY_DBT.DBT_SNOWFLAKE_DDL_EXECUTION
SELECT 
    710710 AS PCCT_NUMBER  ,
    '{{v_scripts|replace("'","''")}}' AS DDL_EXECUTED ,
    'CLINT.WHETTEN' AS BIW_CREATED_BY,
    CURRENT_TIMESTAMP(0)::TIMESTAMP_NTZ AS BIW_CREATED_DTTM,
    'CLINT.WHETTEN' AS BIW_UPD_BY ,
    CURRENT_TIMESTAMP(0)::TIMESTAMP_NTZ AS BIW_UPD_DTTM
{% endmacro %}