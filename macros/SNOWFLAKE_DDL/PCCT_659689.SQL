{% macro PCCT_659689() -%}
 {################# Step 1 DECLARE SCRIPTS/DDL NEED TO EXECUTED #################}
{%- set v_scripts -%} 

CREATE OR REPLACE TABLE {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_SALES.CUSTOMER_HIST_PV20230125 CLONE 
 {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_SALES.CUSTOMER_HIST;

DROP TABLE {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_SALES.CUSTOMER_HIST;

CREATE OR REPLACE TABLE {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_SALES.CUSTOMER_HIST AS
SELECT
	CUSTOMER_KEY,
	CUSTOMER_CODE,
	ERP_SITE_USE_ID,
	ERP_STATUS,
	CRM_CUSTOMER_OID,
	CRM_STATUS,
	CUSTOMER_NAME,
	CUSTOMER_TYPE_CODE,
	CUSTOMER_TYPE_DESCRIPTION,
	CUSTOMER_SOURCE,
	BUSINESS_CLASS_CODE,
	CORPORATION_CODE,
	CORPORATION_DESCRIPTION,
	END_CORPORATION_CODE,
	END_CORPORATION_DESCRIPTION,
	SALES_ORGANIZATION_CODE,
	END_USE_CODE,
	END_USE_DESCRIPTION,
	CURRENCY_CODE,
	ISO_CURRENCY_CODE,
	HAS_CREDIT_HOLD,
	HAS_SERVICE_HOLD,
	HAS_APPROVAL,
	ORDER_PROCESSING_REGION_CODE,
	CRD_SHIP_EARLY_DAYS_QUANTITY,
	HAS_CRD_PARTIAL,
	SHIP_VIA_CODE,
	HAS_SHIP_TO_CRD,
	SHIP_LATE_DAYS_QUANTITY,
	BILL_CUSTOMER_CODE,
	HANDLING_METHOD_CODE,
	HANDLING_METHOD_CODE_DESCRIPTION,
	IS_EDI_CUSTOMER,
	FINAL_DESTINATION_DESCRIPTION,
	BILL_COUNTRY_SOURCE_CODE,
	FOB_OPTION_CODE,
	PAYMENT_TERM_CODE,
	FINANCIAL_BANK_ID,
	TRANSIT_DAYS_QUANTITY,
	DELIVERY_TYPE_CODE,
	DATE_CODE_MAXIMUM_AGE_QUANTITY,
	IS_CPN_REQUIRED,
	VAT_TAX_CODE,
	MINIMUM_DOLLAR_VALUE_AMOUNT,
	IS_MINIMUM_DOLLAR_VALUE_VALID,
	CORPORATION_CATEGORY_CODE,
	CORPORATION_CATEGORY_DESCRIPTION,
	CUSTOMER_ENTITY_CODE,
	FORECAST_TYPE_CODE,
	IS_FORECAST_CUSTOMER,
	FORECAST_CUSTOMER_STATUS_CODE,
	REPLENISHMENT_CODE,
	SERVICE_TYPE_CODE,
	CHANGE_ORDER_APROVAL_REQUIRED_CODE,
	UDC_GENERIC_PROG_DESCRIPTION,
	CREATE_BY_ID,
	CREATE_DTTM,
	LAST_UPDATE_BY_ID,
	LAST_UPDATE_DTTM,
	IS_DELETED,
	QUALITY_CODE,
	FISCAL_ACCOUNT_NUMBER,
	CREDIT_LIMIT_AMOUNT,
	DIVISION,
	SALES_STRUCTURE,
	MARKET_SEGMENT_CODE,
	IS_ASSEMBLY_LOCATION,
	OPERATING_UNIT,
	COF_CODE,
	COG_CODE,
	CUSTOMER_SHUT_DOWN_FROM_DATE,
	CUSTOMER_SHUT_DOWN_TO_DATE,
	FOB_OPTION_DESCRIPTION,
	TAX_CODE,
	ORACLE_ORDER_TYPE,
	ORACLE_PAYMENT_TERM,
	ORACLE_SITE_STATUS,
	ORACLE_SITE_NUMBER,
	ORACLE_SHIP_METHOD,
	FREE_TRADE_ZONE,
	COLLECTOR_NAME,
	IS_SHUTDOWN,
	CSR_USER_ID,
	CSR_FIRST_NAME,
	CSR_LAST_NAME,
	CSR_EMAIL,
	CSR_PHONE,
	CSR_CONTACT_LAST_UPDATE_BY,
	CSR_CONTACT_CREATED_BY,
	FQA_USER_ID,
	FQA_FIRST_NAME,
	FQA_LAST_NAME,
	FQA_EMAIL,
	FQA_PHONE,
	FQA_CONTACT_LAST_UPDATE_BY,
	FQA_CONTACT_CREATED_BY,
	BUYER_USER_ID,
	BUYER_FIRST_NAME,
	BUYER_LAST_NAME,
	BUYER_EMAIL,
	BUYER_PHONE,
	BUYER_CONTACT_LAST_UPDATE_BY,
	BUYER_CONTACT_CREATED_BY,
	FSE_USER_ID,
	FSE_FIRST_NAME,
	FSE_LAST_NAME,
	FSE_EMAIL,
	FSE_PHONE,
	FSE_CONTACT_LAST_UPDATE_BY,
	FSE_CONTACT_CREATED_BY,
	BIW_INS_DTTM,
	BIW_UPD_DTTM,
	BIW_BATCH_ID,
	BIW_MD5_KEY::BINARY AS BIW_MD5_KEY,
	DBT_SCD_ID,
	DBT_UPDATED_AT,
	DBT_VALID_FROM,
	DBT_VALID_TO
FROM {{env_var('DBT_EDW_DB')~env_var('DBT_DEP_ENV')}}.MART_SALES.CUSTOMER_HIST_PV20230125;

{%endset%}

{################# Step 2 EXECUTE SCRIPTS #################}
{% do run_query(v_scripts) %}

{################# Step 3 CAPTURE INTO DBT TABLE #################}
Insert into var('V_EDL_DEFAULT_DB')+env_var('DBT_DEP_ENV').UTILITY_DBT.DBT_SNOWFLAKE_DDL_EXECUTION
SELECT 
    659689 AS PCCT_NUMBER  ,
    '{{v_scripts|replace("'","''")}}' AS DDL_EXECUTED ,
    'VINAY.SUBRAMANIAN' AS BIW_CREATED_BY,
    CURRENT_TIMESTAMP(0)::TIMESTAMP_NTZ AS BIW_CREATED_DTTM,
    'VINAY.SUBRAMANIAN' AS BIW_UPD_BY ,
    CURRENT_TIMESTAMP(0)::TIMESTAMP_NTZ AS BIW_UPD_DTTM
{% endmacro %}