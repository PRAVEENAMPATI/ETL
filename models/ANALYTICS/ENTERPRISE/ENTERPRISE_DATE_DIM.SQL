{{ config(
  description = 'DATE dimension', 
  materialized = 'view', 
  schema = 'ENTERPRISE', 
  tags = ['MART'],
  alias = 'DATE_DIM'
) }} 

SELECT 
    DATE_KEY , 
    CALENDAR_DATE , 
    DAY_NUMBER , 
    DAY_OF_WEEK_SHORT_DESCRIPTION , 
    DAY_OF_WEEK_DESCRIPTION , 
    CALENDAR_DATE = CURRENT_DATE() IS_CURRENT_DAY, 
    CALENDAR_DATE = CURRENT_DATE() -1 IS_PRIOR_DAY, 
    IS_WEEKDAY , 
    IS_WEEKEND , 
    IS_BEGIN_FISCAL_WEEK , 
    IS_END_FISCAL_WEEK , 
    IS_BEGIN_FISCAL_MONTH , 
    IS_END_FISCAL_MONTH , 
    IS_BEGIN_FISCAL_QUARTER , 
    IS_END_FISCAL_QUARTER , 
    IS_BEGIN_FISCAL_YEAR , 
    IS_END_FISCAL_YEAR , 
    DATE_SEQUENCE , 
    DAY_IN_FISCAL_WEEK , 
    DAY_IN_FISCAL_MONTH , 
    DAY_IN_FISCAL_QUARTER , 
    DAY_IN_FISCAL_YEAR , 
    DAY_IN_MONTH , 
    DAY_IN_QUARTER , 
    DAY_IN_YEAR , 
    MONTH_KEY , 
    MONTH , 
    MONTH_KEY = CAST (  TO_CHAR ( CURRENT_DATE(), 'YYYYMM' ) AS INT  ) IS_CURRENT_MONTH, 
    MONTH_SEQUENCE = 12 *(CAST(YEAR(CURRENT_DATE()) AS INT) -1970) + (CAST(MONTH(CURRENT_DATE()) AS INT) -2    ) IS_PRIOR_MONTH, 
    MONTH_SEQUENCE = 12 *(CAST(YEAR(CURRENT_DATE()) AS INT) -1970 ) + (CAST(MONTH(CURRENT_DATE()) AS INT ) -13  ) IS_PRIOR_YEAR_CURRENT_MONTH, 
    MONTH_NUMBER , 
    MONTH_SHORT_DESCRIPTION , 
    MONTH_DESCRIPTION , 
    MONTH_BEGIN_DATE , 
    MONTH_END_DATE , 
    TOTAL_DAYS_IN_MONTH , 
    MONTH_SEQUENCE , 
    MONTH_IN_QUARTER , 
    MONTH_IN_YEAR , 
    QUARTER_KEY , 
    QUARTER , 
    QUARTER_KEY = CAST(  YEAR(  CURRENT_DATE() ) || QUARTER(CURRENT_DATE()) AS INT ) IS_CURRENT_QUARTER, 
    QUARTER_SEQUENCE = 4 *( CAST(YEAR(CURRENT_DATE()) AS INT) -1970) + (CAST( QUARTER( CURRENT_DATE()) AS INT ) -2 ) IS_PRIOR_QUARTER, 
    QUARTER_SEQUENCE = 4 *( CAST(YEAR(CURRENT_DATE()) AS INT) -1970) + (CAST(QUARTER(CURRENT_DATE()) AS INT  ) -5  ) IS_PRIOR_YEAR_CURRENT_QUARTER, 
    QUARTER_NUMBER , 
    QUARTER_DESCRIPTION , 
    QUARTER_BEGIN_DATE , 
    QUARTER_END_DATE , 
    TOTAL_DAYS_IN_QUARTER , 
    TOTAL_MONTHS_IN_QUARTER , 
    QUARTER_SEQUENCE , 
    QUARTER_IN_YEAR , 
    YEAR_KEY YEAR_KEY, 
    YEAR , 
    YEAR_KEY = CAST( YEAR( CURRENT_DATE() ) AS INT  ) IS_CURRENT_YEAR, 
    YEAR_KEY = CAST( YEAR(   CURRENT_DATE()  ) AS INT  ) -1 IS_PRIOR_YEAR, 
    YEAR_DESCRIPTION , 
    YEAR_BEGIN_DATE , 
    YEAR_END_DATE , 
    TOTAL_DAYS_IN_YEAR , 
    TOTAL_MONTHS_IN_YEAR , 
    TOTAL_QUARTERS_IN_YEAR , 
    YEAR_SEQUENCE , 
    FISCAL_WEEK_KEY , 
    FISCAL_WEEK , 
    FISCAL_WEEK_KEY = ( SELECT  FISCAL_WEEK_KEY FROM {{ref('MART_DATE')}} WHERE  CALENDAR_DATE = CURRENT_DATE() ) IS_CURRENT_FISCAL_WEEK, 
    FISCAL_WEEK_SEQUENCE = ( SELECT FISCAL_WEEK_SEQUENCE FROM  {{ref('MART_DATE')}} WHERE CALENDAR_DATE = CURRENT_DATE() ) -1 IS_PRIOR_FISCAL_WEEK, 
    FISCAL_WEEK_SEQUENCE = (SELECT  FISCAL_WEEK_SEQUENCE FROM {{ref('MART_DATE')}} WHERE CALENDAR_DATE = CURRENT_DATE() ) -52 IS_PRIOR_FISCAL_YEAR_CURRENT_FISCAL_WEEK, 
    FISCAL_WEEK_NUMBER , 
    FISCAL_WEEK_BEGIN_DATE , 
    FISCAL_WEEK_END_DATE , 
    TOTAL_DAYS_IN_FISCAL_WEEK , 
    FISCAL_WEEK_SEQUENCE , 
    FISCAL_WEEK_IN_FISCAL_MONTH , 
    FISCAL_WEEK_IN_FISCAL_QUARTER , 
    FISCAL_WEEK_IN_FISCAL_YEAR , 
    CRAWL_WEEK_IN_FISCAL_QUARTER , 
    CRAWL_WEEK_IN_FISCAL_QUARTER_PLUS_1 , 
    CRAWL_WEEK_IN_FISCAL_QUARTER_PLUS_2 , 
    FISCAL_MONTH_KEY , 
    FISCAL_MONTH , 
    FISCAL_MONTH_KEY = (SELECT FISCAL_MONTH_KEY FROM {{ref('MART_DATE')}} WHERE CALENDAR_DATE = CURRENT_DATE()) IS_CURRENT_FISCAL_MONTH, 
    FISCAL_MONTH_SEQUENCE = (SELECT FISCAL_MONTH_SEQUENCE FROM {{ref('MART_DATE')}} WHERE  CALENDAR_DATE = CURRENT_DATE() ) -1 IS_PRIOR_FISCAL_MONTH, 
    FISCAL_MONTH_SEQUENCE = (SELECT FISCAL_MONTH_SEQUENCE FROM {{ref('MART_DATE')}} WHERE  CALENDAR_DATE = CURRENT_DATE() ) -12 IS_PRIOR_FISCAL_YEAR_CURRENT_FISCAL_MONTH, 
    FISCAL_MONTH_NUMBER , 
    FISCAL_MONTH_DESCRIPTION , 
    FISCAL_MONTH_BEGIN_DATE , 
    FISCAL_MONTH_END_DATE , 
    TOTAL_DAYS_IN_FISCAL_MONTH , 
    TOTAL_FISCAL_WEEKS_IN_FISCAL_MONTH , 
    FISCAL_MONTH_SEQUENCE , 
    FISCAL_MONTH_IN_FISCAL_QUARTER , 
    FISCAL_MONTH_IN_FISCAL_YEAR , 
    FISCAL_QUARTER_KEY , 
    FISCAL_QUARTER , 
    FISCAL_QUARTER_YYYYQQ , 
    FISCAL_QUARTER_KEY = (SELECT     FISCAL_QUARTER_KEY     FROM {{ref('MART_DATE')}} WHERE  CALENDAR_DATE = CURRENT_DATE()) IS_CURRENT_FISCAL_QUARTER, 
    FISCAL_QUARTER_SEQUENCE = ( SELECT FISCAL_QUARTER_SEQUENCE FROM {{ref('MART_DATE')}} WHERE  CALENDAR_DATE = CURRENT_DATE() ) -1 IS_PRIOR_FISCAL_QUARTER, 
    FISCAL_QUARTER_SEQUENCE = ( SELECT FISCAL_QUARTER_SEQUENCE FROM {{ref('MART_DATE')}} WHERE  CALENDAR_DATE = CURRENT_DATE() ) -4 IS_PRIOR_FISCAL_YEAR_CURRENT_FISCAL_QUARTER, 
    FISCAL_QUARTER_NUMBER , 
    FISCAL_QUARTER_DESCRIPTION , 
    FISCAL_QUARTER_BEGIN_DATE , 
    FISCAL_QUARTER_END_DATE , 
    TOTAL_DAYS_IN_FISCAL_QUARTER , 
    TOTAL_FISCAL_WEEKS_IN_FISCAL_QUARTER , 
    TOTAL_FISCAL_MONTHS_IN_FISCAL_QUARTER , 
    FISCAL_QUARTER_SEQUENCE , 
    FISCAL_QUARTER_IN_FISCAL_YEAR , 
    FISCAL_QUARTER_PRIOR_FOUR , 
    FISCAL_QUARTER_PRIOR_THREE , 
    FISCAL_QUARTER_PRIOR_TWO , 
    FISCAL_QUARTER_PRIOR , 
    FISCAL_QUARTER_NEXT , 
    FISCAL_QUARTER_NEXT_TWO , 
    FISCAL_QUARTER_NEXT_THREE , 
    FISCAL_QUARTER_NEXT_FOUR , 
    FISCAL_QUARTER_PRIOR_YEAR , 
    FISCAL_YEAR_KEY , 
    FISCAL_YEAR , 
    FISCAL_YEAR_KEY = (SELECT FISCAL_YEAR_KEY FROM {{ref('MART_DATE')}} WHERE  CALENDAR_DATE = CURRENT_DATE()) IS_CURRENT_FISCAL_YEAR, 
    FISCAL_YEAR_KEY = (SELECT FISCAL_YEAR_KEY FROM {{ref('MART_DATE')}} WHERE  CALENDAR_DATE = CURRENT_DATE()) -1 IS_PRIOR_FISCAL_YEAR, 
    FISCAL_YEAR_BEGIN_DATE , 
    FISCAL_YEAR_END_DATE , 
    TOTAL_DAYS_IN_FISCAL_YEAR , 
    TOTAL_FISCAL_WEEKS_IN_FISCAL_YEAR , 
    TOTAL_FISCAL_MONTHS_IN_FISCAL_YEAR , 
    TOTAL_FISCAL_QUARTERS_IN_FISCAL_YEAR , 
    FISCAL_YEAR_SEQUENCE , 
    FISCAL_YEAR_PRIOR , 
    FISCAL_WEEK_PRIOR,
    FISCAL_WEEK_PRIOR_BEGIN_DATE,
    FISCAL_WEEK_PRIOR_END_DATE,
    FISCAL_MONTH_PRIOR,
    FISCAL_MONTH_PRIOR_BEGIN_DATE,
    FISCAL_MONTH_PRIOR_END_DATE,
    FISCAL_QUARTER_PRIOR_BEGIN_DATE,
    FISCAL_QUARTER_PRIOR_END_DATE,
    BIW_INS_DTTM , 
    BIW_UPD_DTTM , 
    BIW_BATCH_ID  
FROM 
  	{{ref('MART_DATE')}}
