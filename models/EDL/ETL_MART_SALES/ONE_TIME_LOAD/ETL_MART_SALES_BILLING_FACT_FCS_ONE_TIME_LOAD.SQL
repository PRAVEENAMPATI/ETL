/*---------------------------------------------------------------------------
Command to run model:
--dbt run --select ETL_MART_SALES_BILLING_FACT_FCS_ONE_TIME_LOAD --vars 'is_backfill: True'

Version     Date            Author          Description
-------     --------        -----------     ----------------------------------
1.0         09/26/2022      Sruthi Kasbe    Initial Version
2.0         10/18/2022      Sruthi Kasbe    Updated customer columns and its order
---------------------------------------------------------------------------*/
{################# EDW Job Template Variables #################}
{%-set v_pk_list = ['BILLING_KEY']-%}
{%-set v_house_keeping_column = ['BIW_INS_DTTM','BIW_UPD_DTTM','BIW_BATCH_ID','BIW_MD5_KEY']-%}
/*--DBT Variable used during development*/
{% if is_incremental() %}
{%-set v_all_column_list =  edw_get_column_list( this ) -%}
{%-set v_update_column_list = edw_get_quoted_column_list( this ,v_pk_list|list + ['BIW_INS_DTTM']|list) -%}
{%-set v_md5_column_list =  edw_get_md5_column_list( this ,v_pk_list|list+ v_house_keeping_column|list ) -%}
/*--DBT Variable*/
/*--SELECT {{v_all_column_list}}*/
/*--SELECT {{v_update_column_list}}*/
/*--SELECT {{v_md5_column_list}}*/
/*-SELECT {{v_md5_column_list}}*/
{% endif %}

{################# Batch control insert and update SQL #################}
{%- set v_dbt_job_name = 'DBT_ETL_MART_SALES_BILLING_FACT_FCS_ONE_TIME_LOAD'-%}
-- Step 1 Batch process info
{%- set v_watermark = edw_batch_control(v_dbt_job_name,config.get('schema'),config.get('alias') ,config.get('tags'),config.get('materialized') ) -%}
{%- set V_LWM = v_watermark[0] -%}
{%- set V_HWM = v_watermark[1] -%}
{%- set V_START_DTTM = v_watermark[2] -%}
{%- set V_BIW_BATCH_ID = v_watermark[3] -%}
{%- set v_sql_upd_success_batch = "CALL UTILITY.EDW_BATCH_SUCCESS_PROC('"~v_dbt_job_name~"')" -%}


{################# Snowflake Object Configuration #################}
{{
    config(
         description = 'Building ETL table BILLING Fact FCS for Sales Mart '
        ,transient=true
        ,materialized='view'
        ,schema ='ETL_MART_SALES'
        ,alias='BILLING_FACT_FCS'
        ,tags =['MART_SALES']
        )
}}


------------------------------------ CORPORATION REFERENCE ---------------------------------------------
WITH CORPORATION AS
(
SELECT
KEY_CORPORATION,
CORP_CD
FROM
 {{source('STG_SDM_PRESENTATION','LKP_CORPORATIONS')}}
),

------------------------------------ FCS & CORPORATION REFERENCE ---------------------------------------------
STG_FCS AS
(
SELECT 
REPLACE(SUBSTRING(FCS.PROCESS_DATE,1,10),'-')::NUMBER AS TRANSACTION_DATE_KEY,
MD5(FCS.SHIP_TO_CUST_CD) AS DIRECT_CUSTOMER_KEY,
MD5(FCS.IND_CUST_CODE) AS INDIRECT_CUSTOMER_KEY,
MD5(FCS.END_CUST_CD) AS END_CUSTOMER_KEY,
MD5(COALESCE(DIR_CORP.CORP_CD,FCS.KEY_DIRCORPORATION::string)) AS DIRECT_CORPORATION_KEY,
MD5(COALESCE(ENDIR_CORP.CORP_CD,FCS.KEY_ENDCORPORATION::string)) AS END_CORPORATION_KEY,
MD5(COALESCE(FCS.PRODUCT_ID,'-1')) AS MARKET_PRODUCT_NUMBER_KEY,
MD5(COALESCE(FCS.PRODUCT_ID,'-1')) AS INTERNAL_PART_NUMBER_KEY,


DIR_CORP.CORP_CD AS DIRECT_CORPORATION_CODE,
ENDIR_CORP.CORP_CD AS END_CORPORATION_CODE,

FCS.PROCESS_DATE,
FCS.SOURCE_OF_SALE,
FCS.SALES_ORDER_LI_DL AS SALES_ORDER_LINE_ITEM_DELIVERY,
FCS.SALES_ORDER_NUM AS SALES_ORDER_NUMBER,
FCS.SALES_ITEM_NUM AS SALES_ITEM_NUMBER,
FCS.SALES_DELIVERY_NUM AS SALES_DELIVERY_NUMBER,
FCS.PRODUCT_ID AS INTERNAL_PART_NUMBER,
FCS.PRODUCT_ID AS MARKET_PRODUCT_NUMBER,
FCS.ORDER_TYPE,
FCS.HANDLING_CODE,

CASE 
when CUST_PART_NUM='No Value'
Then NULL
Else CUST_PART_NUM
END AS CUSTOMER_PART_NUMBER,

FCS.CUST_PA_NUM AS CUSTOMER_PA_NUMBER,
FCS.END_CUST_CD AS END_CUSTOMER_CODE,	
FCS.DIST_END_CUST_CD AS DIST_END_CUSTOMER_CODE,
FCS.IND_CUST_CODE AS INDIRECT_CUSTOMER_CODE,
FCS.SHIP_TO_CUST_CD AS DIRECT_CUSTOMER_CODE,
FCS.CRD_DT AS REQUESTED_DATE,
FCS.MSD_DT AS ORIGINAL_SCHEDULED_SHIP_DATE,
FCS.RSD_DT AS SCHEDULED_SHIPPED_DATE,
FCS.EPSD_DT AS EARLIEST_POSSIBLE_SHIP_DATE,
FCS.PDD_DT AS PLANNED_DELIVERY_DATE,
FCS.RDD_DT AS RESCHEDULED_DELIVERY_DATE,
FCS.CRSD_DT AS REQUESTED_SHIP_DATE,
FCS.BILL_TO_COUNTRY,
FCS.BILL_TO_CUSTCODE AS BILL_TO_CUST_CODE,
FCS.SHIP_FROM_AREA,
FCS.CUST_PO_NUM AS CUSTOMER_PO_NUMBER,
FCS.QUOTE_ID,
FCS.OPERATING_UNIT,
FCS.ITEM_STATUS,
FCS.REVERSAL_REQUIRED_FLAG::BOOLEAN AS IS_REVERSAL_REQUIRED,
FCS.ACTIVITY,
FCS.BOOKING_CATEGORY,
FCS.BILL_SOURCE_CD AS BILL_SOURCE_CODE,
FCS.CREDIT_REASON_CD AS CREDIT_REASON_CODE,
FCS.CREDIT_CODE_DESC as CREDIT_CODE_DESCRIPTION,
FCS.PRICE_SOURCE,
FCS.GL_POSTED_DATE,
FCS.TRANSACTION_DATE,
FCS.CUSTOMER_TRX_ID,
FCS.CUSTOMER_TRX_LINE_ID,
FCS.OBR_TRX_ID,
FCS.TRX_LINE_NUM AS TRX_LINE_NUMBER ,
FCS.BILLING_DOCUMENT_NUMBER,
FCS.ORIGINAL_DOCUMENT_NUM AS ORIGINAL_DOCUMENT_NUMBER,
FCS.TRUE_BILL_FLG::BOOLEAN AS IS_TRUE_BILL,
FCS.GL_REV_ACCT AS GL_REVENUE_ACCOUNT,
FCS.ACCRUAL_CATEGORY,
FCS.JOURNAL_DESCRIPTION,
FCS.LEDGER,
FCS.DEBIT_ACCOUNT,
FCS.CREDIT_ACCOUNT,
FCS.ACCRUAL_RULESET AS ACCRUAL_RULE_SET,
FCS.ACCRUAL_RULEID AS ACCRUAL_RULE_ID,
FCS.ACCRUAL_COMMENTS,
FCS.ACCRUAL_TYPE,
FCS.ACCRUAL_FACTOR,
FCS.ACCRUAL_TRANSACTION_DATE,
FCS.ACCRUAL_FLAG_DSA::BOOLEAN AS IS_ACCRUAL_DSA,
FCS.ACCRUAL_FLAG_DCD::BOOLEAN AS IS_ACCRUAL_DCD,
FCS.ACCRUAL_FLAG_REB::BOOLEAN AS IS_ACCRUAL_REB,
FCS.ACCRUAL_FLAG_DSC::BOOLEAN AS IS_ACCRUAL_DSC,
FCS.ACCRUAL_FLAG_REVERSAL::BOOLEAN AS IS_ACCRUAL_REVERSAL,
FCS.QUANTITY_OVERRIDE_FLAG::BOOLEAN AS IS_QUANTITY_OVERRIDE,
FCS.TRANSACTION_CURRENCY AS TRANSACTION_CURRENCY_ISO_CODE,
FCS.CONTRACT_CURRENCY,
FCS.BILL_GROSS_QTY AS BILLING_GROSS_QUANTITY,
FCS.BILLING_QTY AS BILLING_NET_QUANTITY,
FCS.UNIT_PRICE AS UNIT_PRICE_USD,
FCS.TRX_UNIT_PRICE AS UNIT_PRICE_TRANSACTION_CURRENCY,
FCS.CONTRACT_CURRENCY_GROSS_AMT AS GROSS_AMOUNT_CONTRACT_CURRENCY,
FCS.CONTRACT_CURRENCY_NET_AMT AS BILLING_NET_AMOUNT_CONTRACT_CURRENCY,
FCS.ACCRUAL_AMOUNT AS ACCRUAL_AMOUNT_USD,
FCS.TRX_ACCRUAL_AMT AS ACCRUAL_AMOUNT_TRANSACTION_CURRENCY,
FCS.CONTRACT_CURRENCY_ACCRUAL_AMT AS ACCRUAL_AMOUNT_CONTRACT_CURRENCY,
FCS.DW_CREATE_DT,
FCS.BILLING_NET_USD AS BILLING_NET_AMOUNT_USD,
FCS.BILLING_NET_EUR AS BILLING_NET_AMOUNT_EUR,
FCS.BILLING_NET_JPY AS BILLING_NET_AMOUNT_JPY,
FCS.BILLING_GROSS_USD AS GROSS_AMOUNT_USD,
FCS.BILLING_GROSS_EUR AS GROSS_AMOUNT_EUR,
FCS.BILLING_GROSS_JPY AS GROSS_AMOUNT_JPY,
NULL AS REGION,
NULL AS ENTRY_DATE,
NULL AS CUSTOMER_OF_INTEREST,
NULL AS IS_NNCO,
NULL AS NNCO_AGREEMENT_TYPE,
NULL AS ODM_END_CORP_CODE,
NULL AS SUB_CORP_CODE,
NULL AS BUSINESS_CLASS_CODE,
NULL AS BILLING_NET_AMOUNT_TRANSACTION_CURRENCY,
NULL AS GROSS_AMOUNT_TRANSACTION_CURRENCY,
NULL AS UNIT_PRICE_EUR,
NULL AS UNIT_PRICE_JPY,
'{{V_START_DTTM}}'::TIMESTAMP_NTZ BIW_INS_DTTM ,
'{{V_START_DTTM}}'::TIMESTAMP_NTZ BIW_UPD_DTTM ,
{{V_BIW_BATCH_ID}} as BIW_BATCH_ID,
md5(object_construct ('col1',TRANSACTION_DATE_KEY, 'col2',DIRECT_CORPORATION_CODE, 'col3',END_CORPORATION_CODE, 'col4',PROCESS_DATE, 'col5',SOURCE_OF_SALE,
'col6',SALES_ORDER_LI_DL, 'col7',SALES_ORDER_NUM, 'col8',SALES_ITEM_NUM, 'col9',SALES_DELIVERY_NUM, 'col10',PRODUCT_ID, 'col11',ORDER_TYPE, 'col12',HANDLING_CODE,
'col13',CUSTOMER_PART_NUMBER, 'col14',CUST_PA_NUM, 'col15',END_CUST_CD, 'col16',DIST_END_CUST_CD, 'col17',IND_CUST_CODE, 'col18',SHIP_TO_CUST_CD, 'col19',CRD_DT,
'col20',MSD_DT, 'col21',RSD_DT, 'col22',EPSD_DT, 'col23',PDD_DT, 'col24',RDD_DT, 'col25',CRSD_DT, 'col26',BILL_TO_COUNTRY,'col27',BILL_TO_CUSTCODE, 'col28',SHIP_FROM_AREA,
'col29',CUST_PO_NUM, 'col30',QUOTE_ID, 'col31',OPERATING_UNIT, 'col32',ITEM_STATUS, 'col33',REVERSAL_REQUIRED_FLAG, 'col34',ACTIVITY, 'col35',BOOKING_CATEGORY,
'col36',BILL_SOURCE_CD, 'col37',CREDIT_REASON_CD, 'col38',CREDIT_CODE_DESC, 'col39',PRICE_SOURCE, 'col40',GL_POSTED_DATE, 'col41',TRANSACTION_DATE, 'col42',CUSTOMER_TRX_ID,
'col43',CUSTOMER_TRX_LINE_ID, 'col44',OBR_TRX_ID, 'col45',TRX_LINE_NUM, 'col46',BILLING_DOCUMENT_NUMBER, 'col47',ORIGINAL_DOCUMENT_NUM, 'col48',TRUE_BILL_FLG,
'col49',GL_REV_ACCT, 'col50',ACCRUAL_CATEGORY, 'col51',JOURNAL_DESCRIPTION, 'col52',LEDGER, 'col53',DEBIT_ACCOUNT, 'col54',CREDIT_ACCOUNT, 'col55',ACCRUAL_RULESET,
'col56',ACCRUAL_RULEID, 'col57',ACCRUAL_COMMENTS, 'col58',ACCRUAL_TYPE, 'col59',ACCRUAL_FACTOR, 'col60',ACCRUAL_TRANSACTION_DATE, 'col61',ACCRUAL_FLAG_DSA,
'col62',ACCRUAL_FLAG_DCD, 'col63',ACCRUAL_FLAG_REB, 'col64',ACCRUAL_FLAG_DSC, 'col65',ACCRUAL_FLAG_REVERSAL, 'col66',QUANTITY_OVERRIDE_FLAG, 'col67',TRANSACTION_CURRENCY,
'col68',CONTRACT_CURRENCY, 'col69',BILL_GROSS_QTY, 'col70',BILLING_QTY, 'col71',UNIT_PRICE, 'col72',TRX_UNIT_PRICE, 'col73',CONTRACT_CURRENCY_GROSS_AMT,
'col74',CONTRACT_CURRENCY_NET_AMT, 'col75',ACCRUAL_AMOUNT, 'col76',TRX_ACCRUAL_AMT, 'col77',CONTRACT_CURRENCY_ACCRUAL_AMT, 'col778',DW_CREATE_DT, 'col79',BILLING_NET_USD,
'col80',BILLING_NET_EUR, 'col81',BILLING_NET_JPY, 'col82',REGION, 'col83',ENTRY_DATE, 'col84',CUSTOMER_OF_INTEREST, 'col85',IS_NNCO, 'col86',NNCO_AGREEMENT_TYPE,
'col87',ODM_END_CORP_CODE, 'col88',SUB_CORP_CODE, 'col89',BUSINESS_CLASS_CODE, 'col90',BILLING_NET_AMOUNT_TRANSACTION_CURRENCY, 'col91',GROSS_AMOUNT_USD,
'col92',GROSS_AMOUNT_EUR, 'col93',GROSS_AMOUNT_JPY, 'col94',GROSS_AMOUNT_TRANSACTION_CURRENCY, 'col96',UNIT_PRICE_EUR, 'col97',UNIT_PRICE_JPY,
'col98',Billing_Gross_USD, 'col99',Billing_Local_Amt, 'col100',Billing_Local_Gross_Amt, 'col101',Currency_ISO_CD, 'col102',One_Customer_fk, 'col103',One_Product_fk,
'col104',Inferred_Customer_Flag, 'col105',Inferred_Product_Flag, 'col106',GL_FISCAL_PERIOD, 'col07',BATCH_ID, 'col108',Billing_Gross_EUR, 'col109',Billing_Gross_JPY,
'col110',CREATED_DATE, 'col111',MODIFIED_DATE, 'col112',STAGE1_BILL_SEQ, 'col113',KEY_FCSBILLING)::string ) as BILLING_KEY

FROM 
 {{source('STG_SDM_PRESENTATION','FACT_FCSBILLING')}} FCS
LEFT JOIN CORPORATION DIR_CORP
ON FCS.KEY_DIRCORPORATION= DIR_CORP.KEY_CORPORATION
LEFT JOIN CORPORATION ENDIR_CORP
ON FCS.KEY_ENDCORPORATION= ENDIR_CORP.KEY_CORPORATION
),

FINAL_SQL AS (
SELECT 
    BILLING_KEY,
    COALESCE(TRANSACTION_DATE_KEY,'19000101') AS BILLING_DATE_KEY,
    COALESCE(DIRECT_CUSTOMER_KEY, md5(-1)) AS DIRECT_CUSTOMER_KEY,
    COALESCE(INDIRECT_CUSTOMER_KEY, md5(-1)) AS INDIRECT_CUSTOMER_KEY,
    COALESCE(END_CUSTOMER_KEY, md5(-1)) AS END_CUSTOMER_KEY,
    COALESCE(DIRECT_CORPORATION_KEY, md5(-1)) AS DIRECT_CORPORATION_KEY,
    COALESCE(END_CORPORATION_KEY, md5(-1)) AS END_CORPORATION_KEY,
    COALESCE(MARKET_PRODUCT_NUMBER_KEY, md5(-1)) AS MARKET_PRODUCT_NUMBER_KEY,
    COALESCE(INTERNAL_PART_NUMBER_KEY, md5(-1)) AS INTERNAL_PART_NUMBER_KEY,
    DIRECT_CUSTOMER_CODE,
    INDIRECT_CUSTOMER_CODE,
    END_CUSTOMER_CODE,
    DIST_END_CUSTOMER_CODE,
    DIRECT_CORPORATION_CODE,
    END_CORPORATION_CODE,
    MARKET_PRODUCT_NUMBER,
    INTERNAL_PART_NUMBER,
    PROCESS_DATE,
    SOURCE_OF_SALE,
    SALES_ORDER_LINE_ITEM_DELIVERY,
    SALES_ORDER_NUMBER,
    SALES_ITEM_NUMBER,
    SALES_DELIVERY_NUMBER,
    REGION,
    ORDER_TYPE,
    HANDLING_CODE,
    CUSTOMER_PART_NUMBER,
    CUSTOMER_PA_NUMBER,
    REQUESTED_DATE,
    ORIGINAL_SCHEDULED_SHIP_DATE,
    SCHEDULED_SHIPPED_DATE,
    EARLIEST_POSSIBLE_SHIP_DATE,
    PLANNED_DELIVERY_DATE,
    RESCHEDULED_DELIVERY_DATE,
    REQUESTED_SHIP_DATE,
    ENTRY_DATE,
    CUSTOMER_OF_INTEREST,
    IS_NNCO,
    NNCO_AGREEMENT_TYPE,
    ODM_END_CORP_CODE,
    BILL_TO_COUNTRY,
    BILL_TO_CUST_CODE,
    SUB_CORP_CODE,
    SHIP_FROM_AREA,
    CUSTOMER_PO_NUMBER,
    QUOTE_ID,
    OPERATING_UNIT,
    ITEM_STATUS,
    IS_REVERSAL_REQUIRED,
    ACTIVITY,
    BOOKING_CATEGORY,
    BILL_SOURCE_CODE,
    BUSINESS_CLASS_CODE,
    CREDIT_REASON_CODE,
    CREDIT_CODE_DESCRIPTION,
    PRICE_SOURCE,
    GL_POSTED_DATE,
    TRANSACTION_DATE,
    CUSTOMER_TRX_ID,
    CUSTOMER_TRX_LINE_ID,
    OBR_TRX_ID,
    TRX_LINE_NUMBER,
    BILLING_DOCUMENT_NUMBER,
    ORIGINAL_DOCUMENT_NUMBER,
    IS_TRUE_BILL,
    GL_REVENUE_ACCOUNT,
    ACCRUAL_CATEGORY,
    JOURNAL_DESCRIPTION,
    LEDGER,
    DEBIT_ACCOUNT,
    CREDIT_ACCOUNT,
    ACCRUAL_RULE_SET,
    ACCRUAL_RULE_ID,
    ACCRUAL_COMMENTS,
    ACCRUAL_TYPE,
    ACCRUAL_FACTOR,
    ACCRUAL_TRANSACTION_DATE,
    IS_ACCRUAL_DSA,
    IS_ACCRUAL_DCD,
    IS_ACCRUAL_REB,
    IS_ACCRUAL_DSC,
    IS_ACCRUAL_REVERSAL,
    IS_QUANTITY_OVERRIDE,
    TRANSACTION_CURRENCY_ISO_CODE,
    CONTRACT_CURRENCY,
    BILLING_GROSS_QUANTITY,
    BILLING_NET_QUANTITY,
    UNIT_PRICE_USD,
    UNIT_PRICE_EUR,
    UNIT_PRICE_JPY,
    UNIT_PRICE_TRANSACTION_CURRENCY,
    GROSS_AMOUNT_USD,
	GROSS_AMOUNT_EUR,
    GROSS_AMOUNT_JPY,
    GROSS_AMOUNT_TRANSACTION_CURRENCY,
    GROSS_AMOUNT_CONTRACT_CURRENCY,
    BILLING_NET_AMOUNT_USD,
	BILLING_NET_AMOUNT_EUR,
	BILLING_NET_AMOUNT_JPY,
    BILLING_NET_AMOUNT_TRANSACTION_CURRENCY,
    BILLING_NET_AMOUNT_CONTRACT_CURRENCY,
    ACCRUAL_AMOUNT_USD,
    ACCRUAL_AMOUNT_TRANSACTION_CURRENCY,
    ACCRUAL_AMOUNT_CONTRACT_CURRENCY,
    DW_CREATE_DT,
    BIW_INS_DTTM,
    BIW_UPD_DTTM,
    BIW_BATCH_ID
FROM STG_FCS AS FCS	
)

SELECT 
FINAL_SQL.*
,md5(object_construct ('col1',BILLING_DATE_KEY, 'col2',DIRECT_CUSTOMER_KEY, 'col3',INDIRECT_CUSTOMER_KEY, 'col4',DIRECT_CORPORATION_KEY, 'col5',END_CORPORATION_KEY,
'col6',INTERNAL_PART_NUMBER_KEY, 'col7',MARKET_PRODUCT_NUMBER_KEY, 'col8',PROCESS_DATE, 'col9',SOURCE_OF_SALE, 'col10',SALES_ORDER_LINE_ITEM_DELIVERY, 'col11',SALES_ORDER_NUMBER,
'col12',SALES_ITEM_NUMBER, 'col13',SALES_DELIVERY_NUMBER, 'col14',INTERNAL_PART_NUMBER, 'col15',MARKET_PRODUCT_NUMBER, 'col16',REGION, 'col17',ORDER_TYPE, 'col18',HANDLING_CODE,
'col19',CUSTOMER_PART_NUMBER,'col20',CUSTOMER_PA_NUMBER, 'col21',DIRECT_CORPORATION_CODE, 'col22',END_CORPORATION_CODE, 'col23',END_CUSTOMER_CODE, 'col24',DIST_END_CUSTOMER_CODE,
'col25',INDIRECT_CUSTOMER_CODE, 'col26',DIRECT_CUSTOMER_CODE, 'col27',REQUESTED_DATE, 'col28',ORIGINAL_SCHEDULED_SHIP_DATE, 'col29',SCHEDULED_SHIPPED_DATE,
'col30',EARLIEST_POSSIBLE_SHIP_DATE,
'col31',PLANNED_DELIVERY_DATE, 'col32',RESCHEDULED_DELIVERY_DATE, 'col33',REQUESTED_SHIP_DATE, 'col34',ENTRY_DATE, 'col35',CUSTOMER_OF_INTEREST, 'col36',IS_NNCO,
'col37',NNCO_AGREEMENT_TYPE, 'col38',ODM_END_CORP_CODE, 'col39',BILL_TO_COUNTRY, 'col40',BILL_TO_CUST_CODE, 'col41',SUB_CORP_CODE, 'col42',SHIP_FROM_AREA, 
'col43',CUSTOMER_PO_NUMBER, 'col44',QUOTE_ID, 'col45',OPERATING_UNIT, 'col46',ITEM_STATUS, 'col47',IS_REVERSAL_REQUIRED, 'col48',ACTIVITY, 'col49',BOOKING_CATEGORY, 
'col50',BILL_SOURCE_CODE, 'col51',BUSINESS_CLASS_CODE, 'col52',CREDIT_REASON_CODE, 'col53',CREDIT_CODE_DESCRIPTION, 'col54',PRICE_SOURCE, 'col55',GL_POSTED_DATE, 
'col56',TRANSACTION_DATE, 'col57',CUSTOMER_TRX_ID, 'col58',CUSTOMER_TRX_LINE_ID, 'col59',OBR_TRX_ID, 'col60',TRX_LINE_NUMBER, 'col61',BILLING_DOCUMENT_NUMBER, 
'col62',ORIGINAL_DOCUMENT_NUMBER, 'col63',IS_TRUE_BILL, 'col64',GL_REVENUE_ACCOUNT, 'col65',ACCRUAL_CATEGORY, 'col66',JOURNAL_DESCRIPTION, 'col67',LEDGER,
'col68',DEBIT_ACCOUNT, 'col69',CREDIT_ACCOUNT, 'col70',ACCRUAL_RULE_SET, 'col71',ACCRUAL_RULE_ID, 'col72',ACCRUAL_COMMENTS, 'col73',ACCRUAL_TYPE,
'col74',ACCRUAL_FACTOR, 'col75',ACCRUAL_TRANSACTION_DATE, 'col76',IS_ACCRUAL_DSA, 'col77',IS_ACCRUAL_DCD, 'col78',IS_ACCRUAL_REB, 'col79',IS_ACCRUAL_DSC,
'col80',IS_ACCRUAL_REVERSAL, 'col81',IS_QUANTITY_OVERRIDE, 'col82',TRANSACTION_CURRENCY_ISO_CODE, 'col83',CONTRACT_CURRENCY, 'col84',BILLING_GROSS_QUANTITY, 
'col85',BILLING_NET_QUANTITY, 'col86',UNIT_PRICE_USD, 'col87',UNIT_PRICE_EUR, 'col88',UNIT_PRICE_JPY, 'col89',UNIT_PRICE_TRANSACTION_CURRENCY, 'col90',GROSS_AMOUNT_USD,
'col91',GROSS_AMOUNT_EUR, 'col92',GROSS_AMOUNT_JPY, 'col93',GROSS_AMOUNT_TRANSACTION_CURRENCY, 'col94',GROSS_AMOUNT_CONTRACT_CURRENCY, 'col95',BILLING_NET_AMOUNT_USD,
'col96',BILLING_NET_AMOUNT_EUR, 'col97',BILLING_NET_AMOUNT_JPY, 'col98',BILLING_NET_AMOUNT_TRANSACTION_CURRENCY, 'col99',BILLING_NET_AMOUNT_CONTRACT_CURRENCY, 
'col100',ACCRUAL_AMOUNT_USD, 'col101',ACCRUAL_AMOUNT_TRANSACTION_CURRENCY, 'col102',ACCRUAL_AMOUNT_CONTRACT_CURRENCY, 'col103',DW_CREATE_DT,
'col104', END_CUSTOMER_KEY)::string ) as BIW_MD5_KEY
FROM 
FINAL_SQL
