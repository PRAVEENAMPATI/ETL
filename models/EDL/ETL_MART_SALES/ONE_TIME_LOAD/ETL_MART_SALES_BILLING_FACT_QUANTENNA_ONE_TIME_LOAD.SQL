/*---------------------------------------------------------------------------
Command to run model:
--dbt run --select ETL_MART_SALES_BILLING_FACT_QUANTENNA_ONE_TIME_LOAD --vars 'is_backfill: True'

Version     Date            Author          Description
-------     --------        -----------     ----------------------------------
1.0         09/26/2022      Sruthi Kasbe    Initial Version
2.0         10/18/2022      Sruthi Kasbe    Updated customer columns and its order
---------------------------------------------------------------------------*/
{################# EDW Job Template Variables #################}
{%-set v_pk_list = ['BILLING_KEY']-%}
{%-set v_house_keeping_column = ['BIW_INS_DTTM','BIW_UPD_DTTM','BIW_BATCH_ID','BIW_MD5_KEY']-%}
/*--DBT Variable used during development*/
{% if is_incremental() %}
{%-set v_all_column_list =  edw_get_column_list( this ) -%}
{%-set v_update_column_list = edw_get_quoted_column_list( this ,v_pk_list|list + ['BIW_INS_DTTM']|list) -%}
{%-set v_md5_column_list =  edw_get_md5_column_list( this ,v_pk_list|list+ v_house_keeping_column|list ) -%}
/*--DBT Variable*/
/*--SELECT {{v_all_column_list}}*/
/*--SELECT {{v_update_column_list}}*/
/*--SELECT {{v_md5_column_list}}*/
{% endif %}

{################# Batch control insert and update SQL #################}
{%- set v_dbt_job_name = 'DBT_ETL_MART_SALES_BILLING_FACT_QUANTENNA_ONE_TIME_LOAD'-%}
-- Step 1 Batch process info
{%- set v_watermark = edw_batch_control(v_dbt_job_name,config.get('schema'),config.get('alias') ,config.get('tags'),config.get('materialized') ) -%}
{%- set V_LWM = v_watermark[0] -%}
{%- set V_HWM = v_watermark[1] -%}
{%- set V_START_DTTM = v_watermark[2] -%}
{%- set V_BIW_BATCH_ID = v_watermark[3] -%}
{%- set v_sql_upd_success_batch = "CALL UTILITY.EDW_BATCH_SUCCESS_PROC('"~v_dbt_job_name~"')" -%}


{################# Snowflake Object Configuration #################}
{{
    config(
         description = 'Building ETL table BILLING Fact Quantenna for Sales Mart '
        ,transient=true
        ,materialized='view'
        ,schema ='ETL_MART_SALES'
        ,alias='BILLING_FACT_QUANTENNA'
        ,tags =['MART_SALES']
        )
}}

------------------------------------ CORPORATION REFERENCE ---------------------------------------------
WITH CORPORATION AS
(
SELECT
KEY_CORPORATION,
CORP_CD
FROM
 {{source('STG_SDM_PRESENTATION','LKP_CORPORATIONS')}}
),

------------------------------------ QUANTENNA & CORPORATION REFERENCE ---------------------------------------------
STG_QUANTENNA AS
(
SELECT 
REPLACE(SUBSTRING(QUAN.PROCESS_DATE,1,10),'-')::NUMBER AS TRANSACTION_DATE_KEY,
MD5(QUAN.DIR_CUST_CD) AS DIRECT_CUSTOMER_KEY,
MD5(QUAN.IND_CUST_CD) AS INDIRECT_CUSTOMER_KEY,
MD5(QUAN.END_CUST_CD) AS END_CUSTOMER_KEY,
MD5(COALESCE(DIR_CORP.CORP_CD,QUAN.KEY_DIRCORPORATION::string)) AS DIRECT_CORPORATION_KEY,
MD5(COALESCE(ENDIR_CORP.CORP_CD,QUAN.KEY_ENDCORPORATION::string)) AS END_CORPORATION_KEY,
MD5(COALESCE(QUAN.PRODUCT_ID,'-1')) AS MARKET_PRODUCT_NUMBER_KEY,
MD5(COALESCE(QUAN.PRODUCT_ID,'-1')) AS INTERNAL_PART_NUMBER_KEY,

DIR_CORP.CORP_CD AS DIRECT_CORPORATION_CODE,
ENDIR_CORP.CORP_CD AS END_CORPORATION_CODE,

QUAN.PROCESS_DATE,
QUAN.SOURCE_OF_SALE,
QUAN.SALES_ORDER_LI_DL AS SALES_ORDER_LINE_ITEM_DELIVERY,
QUAN.SALES_ORDER_NUM AS SALES_ORDER_NUMBER,
QUAN.SALES_ITEM_NUM AS SALES_ITEM_NUMBER,
QUAN.SALES_DELIVERY_NUM AS SALES_DELIVERY_NUMBER,
QUAN.PRODUCT_ID AS INTERNAL_PART_NUMBER,
QUAN.PRODUCT_ID AS MARKET_PRODUCT_NUMBER,
QUAN.ORDER_TYPE,
QUAN.HANDLING_CODE,

CASE 
when CPN='No Value'
Then NULL
Else CPN
END AS CUSTOMER_PART_NUMBER,

QUAN.CUST_PA_NUM AS CUSTOMER_PA_NUMBER,
QUAN.END_CUST_CD AS END_CUSTOMER_CODE,	
QUAN.DIST_END_CUST_CD AS DIST_END_CUSTOMER_CODE,
QUAN.IND_CUST_CD AS INDIRECT_CUSTOMER_CODE,
QUAN.DIR_CUST_CD AS DIRECT_CUSTOMER_CODE,
QUAN.CRD_DT AS REQUESTED_DATE,
QUAN.MSD_DT AS ORIGINAL_SCHEDULED_SHIP_DATE,
QUAN.RSD_DT AS SCHEDULED_SHIPPED_DATE,
QUAN.EPSD_DT AS EARLIEST_POSSIBLE_SHIP_DATE,
QUAN.PDD_DT AS PLANNED_DELIVERY_DATE,
QUAN.RDD_DT AS RESCHEDULED_DELIVERY_DATE,
QUAN.CRSD_DT AS REQUESTED_SHIP_DATE,
QUAN.BILL_TO_COUNTRY,
QUAN.BILL_TO_CUSTCODE AS BILL_TO_CUST_CODE,
QUAN.SHIP_FROM_AREA,
QUAN.CUST_PO_NUM AS CUSTOMER_PO_NUMBER,
QUAN.QUOTE_ID,
QUAN.OPERATING_UNIT,
QUAN.ITEM_STATUS,
QUAN.REVERSAL_REQUIRED_FLAG::BOOLEAN AS IS_REVERSAL_REQUIRED,
QUAN.ACTIVITY,
QUAN.BOOKING_CATEGORY,
QUAN.BILL_SOURCE_CD AS BILL_SOURCE_CODE,
QUAN.CREDIT_REASON_CD AS CREDIT_REASON_CODE,
QUAN.CREDIT_CODE_DESC as CREDIT_CODE_DESCRIPTION,
QUAN.PRICE_SOURCE,
QUAN.GL_POSTED_DATE,
QUAN.TRANSACTION_DATE,
QUAN.CUSTOMER_TRX_ID,
QUAN.CUSTOMER_TRX_LINE_ID,
QUAN.OBR_TRX_ID,
QUAN.TRX_LINE_NUM AS TRX_LINE_NUMBER ,
QUAN.BILLING_DOCUMENT_NUMBER,
QUAN.ORIGINAL_DOCUMENT_NUM AS ORIGINAL_DOCUMENT_NUMBER,
QUAN.TRUE_BILL_FLG::BOOLEAN AS IS_TRUE_BILL,
QUAN.GL_REV_ACCT AS GL_REVENUE_ACCOUNT,
QUAN.ACCRUAL_CATEGORY,
QUAN.JOURNAL_DESCRIPTION,
QUAN.LEDGER,
QUAN.DEBIT_ACCOUNT,
QUAN.CREDIT_ACCOUNT,
QUAN.ACCRUAL_RULESET AS ACCRUAL_RULE_SET,
QUAN.ACCRUAL_RULEID AS ACCRUAL_RULE_ID,
QUAN.ACCRUAL_COMMENTS,
QUAN.ACCRUAL_TYPE,
QUAN.ACCRUAL_FACTOR,
QUAN.ACCRUAL_TRANSACTION_DATE,
QUAN.ACCRUAL_FLAG_DSA::BOOLEAN AS IS_ACCRUAL_DSA,
QUAN.ACCRUAL_FLAG_DCD::BOOLEAN AS IS_ACCRUAL_DCD,
QUAN.ACCRUAL_FLAG_REB::BOOLEAN AS IS_ACCRUAL_REB,
QUAN.ACCRUAL_FLAG_DSC::BOOLEAN AS IS_ACCRUAL_DSC,
QUAN.ACCRUAL_FLAG_REVERSAL::BOOLEAN AS IS_ACCRUAL_REVERSAL,
QUAN.QUANTITY_OVERRIDE_FLAG::BOOLEAN AS IS_QUANTITY_OVERRIDE,
QUAN.TRANSACTION_CURRENCY AS TRANSACTION_CURRENCY_ISO_CODE,
QUAN.CONTRACT_CURRENCY,
QUAN.BILL_GROSS_QTY AS BILLING_GROSS_QUANTITY,
QUAN.BILLING_QTY AS BILLING_NET_QUANTITY,
QUAN.UNIT_PRICE AS UNIT_PRICE_USD,
QUAN.TRX_UNIT_PRICE AS UNIT_PRICE_TRANSACTION_CURRENCY,
QUAN.CONTRACT_CURRENCY_GROSS_AMT AS GROSS_AMOUNT_CONTRACT_CURRENCY,
QUAN.CONTRACT_CURRENCY_NET_AMT AS BILLING_NET_AMOUNT_CONTRACT_CURRENCY,
QUAN.ACCRUAL_AMOUNT AS ACCRUAL_AMOUNT_USD,
QUAN.TRX_ACCRUAL_AMT AS ACCRUAL_AMOUNT_TRANSACTION_CURRENCY,
QUAN.CONTRACT_CURRENCY_ACCRUAL_AMT AS ACCRUAL_AMOUNT_CONTRACT_CURRENCY,
QUAN.DW_CREATE_DT,
QUAN.BILLING_NET_USD AS BILLING_NET_AMOUNT_USD,
QUAN.BILLING_NET_EUR AS BILLING_NET_AMOUNT_EUR,
QUAN.BILLING_NET_JPY AS BILLING_NET_AMOUNT_JPY,
QUAN.BILLING_GROSS_USD AS GROSS_AMOUNT_USD,
QUAN.BILLING_GROSS_EUR AS GROSS_AMOUNT_EUR,
QUAN.BILLING_GROSS_JPY AS GROSS_AMOUNT_JPY,
NULL AS REGION,
NULL AS ENTRY_DATE,
NULL AS CUSTOMER_OF_INTEREST,
NULL AS IS_NNCO,
NULL AS NNCO_AGREEMENT_TYPE,
NULL AS ODM_END_CORP_CODE,
NULL AS SUB_CORP_CODE,
NULL AS BUSINESS_CLASS_CODE,
NULL AS BILLING_NET_AMOUNT_TRANSACTION_CURRENCY,
NULL AS GROSS_AMOUNT_TRANSACTION_CURRENCY,
NULL AS UNIT_PRICE_EUR,
NULL AS UNIT_PRICE_JPY,
'{{V_START_DTTM}}'::TIMESTAMP_NTZ BIW_INS_DTTM ,
'{{V_START_DTTM}}'::TIMESTAMP_NTZ BIW_UPD_DTTM ,
{{V_BIW_BATCH_ID}} as BIW_BATCH_ID,
md5(object_construct ('col1',BILL_GROSS_QTY::string, 'col2',BILLING_GROSS_USD::string, 'col3',BILLING_LOCAL_AMT::string, 'col4',BILLING_LOCAL_GROSS_AMT::string,
'col5',BILLING_NET_USD::string, 'col6',BILLING_NET_JPY::string, 'col7',BILLING_QTY::string, 'col8',CPN::string, 'col9',CURRENCY_ISO_CD::string, 'col10',DIR_CUST_CD::string,
'col11',KEY_QUANTENNABILLING::string, 'col12',KEY_CALENDARDAY::string, 'col13',KEY_CALENDARMONTH::string, 'col14',KEY_CALENDARQTR::string, 'col15',KEY_CALENDARWEEK::string,
'col16',KEY_CPN::string, 'col17',KEY_CRAWLWEEK::string, 'col18',KEY_CURRENCY::string, 'col19',KEY_DIRCUSTOMER::string, 'col20',KEY_PRODUCT::string, 'col21',KEY_SOURCEOFSALE::string,
'col22',SALES_ITEM_NUM::string, 'col23',SALES_DELIVERY_NUM::string, 'col24',PRODUCT_ID::string, 'col25',SALES_ORDER_NUM::string, 'col26',PROCESS_DATE::string,
'col27',SOURCE_OF_SALE::string, 'col28',WEEK_CRAWL::string, 'col29',IND_CUST_CD::string, 'col30',KEY_INDCUSTOMER::string, 'col31',KEY_ADJUSTEDCORPORATION::string,
'col32',KEY_REFERENCECORPORATION::string, 'col33',KEY_INDCORPORATION::string, 'col34',KEY_ENDCORPORATION::string, 'col35',KEY_DIRCORPORATION::string, 'col36',CREATED_DATE::string,
'col37',MODIFIED_DATE::string, 'col38',KEY_CRAWLQTR::string, 'col39',SALES_ORDER_LI_DL::string, 'col40',ACTIVITY::string, 'col41',BILL_SOURCE_CD::string, 'col42',CRD_DT::string,
'col43',CREDIT_REASON_CD::string, 'col44',CREDIT_CODE_DESC::string, 'col45',TRX_UNIT_PRICE::string, 'col46',MSD_DT::string, 'col47',PRICE_SOURCE::string,
'col48',TRUE_BILL_FLG::string, 'col49',UNIT_PRICE::string, 'col50',BILL_TO_COUNTRY::string, 'col51',SHIP_FROM_AREA::string, 'col52',CUST_PO_NUM::string, 'col53',ORDER_TYPE::string,
'col54',QUOTE_ID::string, 'col55',RSD_DT::string, 'col56',TRX_LINE_NUM::string, 'col57',GL_FISCAL_PERIOD::string, 'col58',OPERATING_UNIT::string, 'col59',BATCH_ID::string,
'col60',BILL_TO_CUSTCODE::string, 'col61',BILLING_DOCUMENT_NUMBER::string, 'col62',HANDLING_CODE::string, 'col63',ITEM_STATUS::string, 'col64',REVERSAL_REQUIRED_FLAG::string,
'col65',TRANSACTION_CURRENCY::string, 'col66',TRANSACTION_DATE::string, 'col67',OBR_TRX_ID::string, 'col68',ACCRUAL_CATEGORY::string, 'col69',JOURNAL_DESCRIPTION::string,
'col70',LEDGER::string, 'col71',DEBIT_ACCOUNT::string, 'col72',CREDIT_ACCOUNT::string, 'col73',ACCRUAL_AMOUNT::string,
'col74',ACCRUAL_RULESET::string, 'col75',ACCRUAL_COMMENTS::string, 'col76',ACCRUAL_TYPE::string, 'col77',ACCRUAL_FACTOR::string, 'col78',ACCRUAL_RULEID::string,
'col79',ACCRUAL_TRANSACTION_DATE::string, 'col80',DW_CREATE_DT::string, 'col81',STAGE1_BILL_SEQ::string, 'col82',TRX_ACCRUAL_AMT::string, 'col83',GL_REV_ACCT::string,
'col84',CUSTOMER_TRX_ID::string, 'col85',CUSTOMER_TRX_LINE_ID::string, 'col86',GL_POSTED_DATE::string, 'col87',ORIGINAL_DOCUMENT_NUM::string, 'col88',CUST_PA_NUM::string,
'col89',QUANTITY_OVERRIDE_FLAG::string, 'col90',EPSD_DT::string, 'col91',PDD_DT::string,
'col92',RDD_DT::string, 'col93',CRSD_DT::string, 'col94',CONTRACT_CURRENCY_ACCRUAL_AMT::string, 'col95',CONTRACT_CURRENCY::string, 'col96',CONTRACT_CURRENCY_NET_AMT::string,
'col97',CONTRACT_CURRENCY_GROSS_AMT::string, 'col98',BOOKING_CATEGORY::string, 'col99',ACCRUAL_FLAG_DSA::string, 'col100',ACCRUAL_FLAG_DCD::string, 'col101',ACCRUAL_FLAG_REB::string,
'col102',ACCRUAL_FLAG_DSC::string, 'col103',ACCRUAL_FLAG_REVERSAL::string, 'col104',END_CUST_CD::string, 'col105',DIST_END_CUST_CD::string, 'col106',BILLING_NET_EUR::string,
'col107',BILLING_GROSS_EUR::string, 'col108',BILLING_GROSS_JPY::string)::string ) as BILLING_KEY

FROM 
 {{source('STG_SDM_PRESENTATION','FACT_QUANTENNABILLING_BASE')}} QUAN
LEFT JOIN CORPORATION DIR_CORP
ON QUAN.KEY_DIRCORPORATION= DIR_CORP.KEY_CORPORATION
LEFT JOIN CORPORATION ENDIR_CORP
ON QUAN.KEY_ENDCORPORATION= ENDIR_CORP.KEY_CORPORATION
),

FINAL_SQL AS (
SELECT 
    BILLING_KEY,
    COALESCE(TRANSACTION_DATE_KEY,'19000101') AS BILLING_DATE_KEY,
    COALESCE(DIRECT_CUSTOMER_KEY, md5(-1)) AS DIRECT_CUSTOMER_KEY,
    COALESCE(INDIRECT_CUSTOMER_KEY, md5(-1)) AS INDIRECT_CUSTOMER_KEY,
    COALESCE(END_CUSTOMER_KEY, md5(-1)) AS END_CUSTOMER_KEY,
    COALESCE(DIRECT_CORPORATION_KEY, md5(-1)) AS DIRECT_CORPORATION_KEY,
    COALESCE(END_CORPORATION_KEY, md5(-1)) AS END_CORPORATION_KEY,
    COALESCE(MARKET_PRODUCT_NUMBER_KEY, md5(-1)) AS MARKET_PRODUCT_NUMBER_KEY,
    COALESCE(INTERNAL_PART_NUMBER_KEY, md5(-1)) AS INTERNAL_PART_NUMBER_KEY,
    DIRECT_CUSTOMER_CODE,
    INDIRECT_CUSTOMER_CODE,
    END_CUSTOMER_CODE,
    DIST_END_CUSTOMER_CODE,
    DIRECT_CORPORATION_CODE,
    END_CORPORATION_CODE,
    MARKET_PRODUCT_NUMBER,
    INTERNAL_PART_NUMBER,
    PROCESS_DATE,
    SOURCE_OF_SALE,
    SALES_ORDER_LINE_ITEM_DELIVERY,
    SALES_ORDER_NUMBER,
    SALES_ITEM_NUMBER,
    SALES_DELIVERY_NUMBER,
    REGION,
    ORDER_TYPE,
    HANDLING_CODE,
    CUSTOMER_PART_NUMBER,
    CUSTOMER_PA_NUMBER,
    REQUESTED_DATE,
    ORIGINAL_SCHEDULED_SHIP_DATE,
    SCHEDULED_SHIPPED_DATE,
    EARLIEST_POSSIBLE_SHIP_DATE,
    PLANNED_DELIVERY_DATE,
    RESCHEDULED_DELIVERY_DATE,
    REQUESTED_SHIP_DATE,
    ENTRY_DATE,
    CUSTOMER_OF_INTEREST,
    IS_NNCO,
    NNCO_AGREEMENT_TYPE,
    ODM_END_CORP_CODE,
    BILL_TO_COUNTRY,
    BILL_TO_CUST_CODE,
    SUB_CORP_CODE,
    SHIP_FROM_AREA,
    CUSTOMER_PO_NUMBER,
    QUOTE_ID,
    OPERATING_UNIT,
    ITEM_STATUS,
    IS_REVERSAL_REQUIRED,
    ACTIVITY,
    BOOKING_CATEGORY,
    BILL_SOURCE_CODE,
    BUSINESS_CLASS_CODE,
    CREDIT_REASON_CODE,
    CREDIT_CODE_DESCRIPTION,
    PRICE_SOURCE,
    GL_POSTED_DATE,
    TRANSACTION_DATE,
    CUSTOMER_TRX_ID,
    CUSTOMER_TRX_LINE_ID,
    OBR_TRX_ID,
    TRX_LINE_NUMBER,
    BILLING_DOCUMENT_NUMBER,
    ORIGINAL_DOCUMENT_NUMBER,
    IS_TRUE_BILL,
    GL_REVENUE_ACCOUNT,
    ACCRUAL_CATEGORY,
    JOURNAL_DESCRIPTION,
    LEDGER,
    DEBIT_ACCOUNT,
    CREDIT_ACCOUNT,
    ACCRUAL_RULE_SET,
    ACCRUAL_RULE_ID,
    ACCRUAL_COMMENTS,
    ACCRUAL_TYPE,
    ACCRUAL_FACTOR,
    ACCRUAL_TRANSACTION_DATE,
    IS_ACCRUAL_DSA,
    IS_ACCRUAL_DCD,
    IS_ACCRUAL_REB,
    IS_ACCRUAL_DSC,
    IS_ACCRUAL_REVERSAL,
    IS_QUANTITY_OVERRIDE,
    TRANSACTION_CURRENCY_ISO_CODE,
    CONTRACT_CURRENCY,
    BILLING_GROSS_QUANTITY,
    BILLING_NET_QUANTITY,
    UNIT_PRICE_USD,
    UNIT_PRICE_EUR,
    UNIT_PRICE_JPY,
    UNIT_PRICE_TRANSACTION_CURRENCY,
    GROSS_AMOUNT_USD,
	GROSS_AMOUNT_EUR,
    GROSS_AMOUNT_JPY,
    GROSS_AMOUNT_TRANSACTION_CURRENCY,
    GROSS_AMOUNT_CONTRACT_CURRENCY,
    BILLING_NET_AMOUNT_USD,
	BILLING_NET_AMOUNT_EUR,
	BILLING_NET_AMOUNT_JPY,
    BILLING_NET_AMOUNT_TRANSACTION_CURRENCY,
    BILLING_NET_AMOUNT_CONTRACT_CURRENCY,
    ACCRUAL_AMOUNT_USD,
    ACCRUAL_AMOUNT_TRANSACTION_CURRENCY,
    ACCRUAL_AMOUNT_CONTRACT_CURRENCY,
    DW_CREATE_DT,
    BIW_INS_DTTM,
    BIW_UPD_DTTM,
    BIW_BATCH_ID
FROM STG_QUANTENNA
)

SELECT 
FINAL_SQL.*
,md5(object_construct ('col1',BILLING_DATE_KEY, 'col2',DIRECT_CUSTOMER_KEY, 'col3',INDIRECT_CUSTOMER_KEY, 'col4',DIRECT_CORPORATION_KEY, 'col5',END_CORPORATION_KEY,
'col6',INTERNAL_PART_NUMBER_KEY, 'col7',MARKET_PRODUCT_NUMBER_KEY, 'col8',PROCESS_DATE, 'col9',SOURCE_OF_SALE, 'col10',SALES_ORDER_LINE_ITEM_DELIVERY, 'col11',SALES_ORDER_NUMBER,
'col12',SALES_ITEM_NUMBER, 'col13',SALES_DELIVERY_NUMBER, 'col14',INTERNAL_PART_NUMBER, 'col15',MARKET_PRODUCT_NUMBER, 'col16',REGION, 'col17',ORDER_TYPE, 'col18',HANDLING_CODE,
'col19',CUSTOMER_PART_NUMBER,'col20',CUSTOMER_PA_NUMBER, 'col21',DIRECT_CORPORATION_CODE, 'col22',END_CORPORATION_CODE, 'col23',END_CUSTOMER_CODE, 'col24',DIST_END_CUSTOMER_CODE,
'col25',INDIRECT_CUSTOMER_CODE, 'col26',DIRECT_CUSTOMER_CODE, 'col27',REQUESTED_DATE, 'col28',ORIGINAL_SCHEDULED_SHIP_DATE, 'col29',SCHEDULED_SHIPPED_DATE,
'col30',EARLIEST_POSSIBLE_SHIP_DATE, 'col31',PLANNED_DELIVERY_DATE, 'col32',RESCHEDULED_DELIVERY_DATE, 'col33',REQUESTED_SHIP_DATE, 'col34',ENTRY_DATE, 'col35',CUSTOMER_OF_INTEREST,
'col36',IS_NNCO, 'col37',NNCO_AGREEMENT_TYPE, 'col38',ODM_END_CORP_CODE, 'col39',BILL_TO_COUNTRY, 'col40',BILL_TO_CUST_CODE, 'col41',SUB_CORP_CODE, 'col42',SHIP_FROM_AREA, 
'col43',CUSTOMER_PO_NUMBER, 'col44',QUOTE_ID, 'col45',OPERATING_UNIT, 'col46',ITEM_STATUS, 'col47',IS_REVERSAL_REQUIRED, 'col48',ACTIVITY, 'col49',BOOKING_CATEGORY, 
'col50',BILL_SOURCE_CODE, 'col51',BUSINESS_CLASS_CODE, 'col52',CREDIT_REASON_CODE, 'col53',CREDIT_CODE_DESCRIPTION, 'col54',PRICE_SOURCE, 'col55',GL_POSTED_DATE, 
'col56',TRANSACTION_DATE, 'col57',CUSTOMER_TRX_ID, 'col58',CUSTOMER_TRX_LINE_ID, 'col59',OBR_TRX_ID, 'col60',TRX_LINE_NUMBER, 'col61',BILLING_DOCUMENT_NUMBER, 
'col62',ORIGINAL_DOCUMENT_NUMBER, 'col63',IS_TRUE_BILL, 'col64',GL_REVENUE_ACCOUNT, 'col65',ACCRUAL_CATEGORY, 'col66',JOURNAL_DESCRIPTION, 'col67',LEDGER,
'col68',DEBIT_ACCOUNT, 'col69',CREDIT_ACCOUNT, 'col70',ACCRUAL_RULE_SET, 'col71',ACCRUAL_RULE_ID, 'col72',ACCRUAL_COMMENTS, 'col73',ACCRUAL_TYPE,
'col74',ACCRUAL_FACTOR, 'col75',ACCRUAL_TRANSACTION_DATE, 'col76',IS_ACCRUAL_DSA, 'col77',IS_ACCRUAL_DCD, 'col78',IS_ACCRUAL_REB, 'col79',IS_ACCRUAL_DSC,
'col80',IS_ACCRUAL_REVERSAL, 'col81',IS_QUANTITY_OVERRIDE, 'col82',TRANSACTION_CURRENCY_ISO_CODE, 'col83',CONTRACT_CURRENCY, 'col84',BILLING_GROSS_QUANTITY, 
'col85',BILLING_NET_QUANTITY, 'col86',UNIT_PRICE_USD, 'col87',UNIT_PRICE_EUR, 'col88',UNIT_PRICE_JPY, 'col89',UNIT_PRICE_TRANSACTION_CURRENCY, 'col90',GROSS_AMOUNT_USD,
'col91',GROSS_AMOUNT_EUR, 'col92',GROSS_AMOUNT_JPY, 'col93',GROSS_AMOUNT_TRANSACTION_CURRENCY, 'col94',GROSS_AMOUNT_CONTRACT_CURRENCY, 'col95',BILLING_NET_AMOUNT_USD,
'col96',BILLING_NET_AMOUNT_EUR, 'col97',BILLING_NET_AMOUNT_JPY, 'col98',BILLING_NET_AMOUNT_TRANSACTION_CURRENCY, 'col99',BILLING_NET_AMOUNT_CONTRACT_CURRENCY, 
'col100',ACCRUAL_AMOUNT_USD, 'col101',ACCRUAL_AMOUNT_TRANSACTION_CURRENCY, 'col102',ACCRUAL_AMOUNT_CONTRACT_CURRENCY, 'col103',DW_CREATE_DT,
'col104',END_CUSTOMER_KEY)::string ) as BIW_MD5_KEY
FROM 
FINAL_SQL
