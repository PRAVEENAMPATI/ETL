/*---------------------------------------------------------------------------
Command to run model:
-- dbt build --full-refresh --select ETL_MART_SALES_CUSTOMER_DWH_ONE_TIME_LOAD
-- dbt build --select ETL_MART_SALES_CUSTOMER_DWH_ONE_TIME_LOAD

Version     Date            Author             Description
-------     --------        -----------        ----------------------------------
1.0         20/10/2022      Vinayaka CN         Initial Version
2.0         02/16/2023      Vinay Subramanian   Added BIll and Ship address columns
---------------------------------------------------------------------------*/
{################# EDW Job Template Variables #################}
{%-set v_pk_list = ['CUSTOMER_KEY']-%}
{%-set v_house_keeping_column = ['BIW_INS_DTTM','BIW_UPD_DTTM','BIW_BATCH_ID','BIW_MD5_KEY']-%}
/*--DBT Variable used during development*/
{% if is_incremental() %}
{%-set v_all_column_list =  edw_get_column_list( this ) -%}
{%-set v_update_column_list = edw_get_quoted_column_list( this ,v_pk_list|list + ['BIW_INS_DTTM']|list) -%}
{%-set v_md5_column_list =  edw_get_md5_column_list( this ,v_pk_list|list+ v_house_keeping_column|list ) -%}
/*--DBT Variable*/
/*--SELECT {{v_all_column_list}}*/
/*--SELECT {{v_update_column_list}}*/
/*--SELECT {{v_md5_column_list}}*/
{% endif %}

{################# Batch control insert and update SQL #################}
{%- set v_dbt_job_name = 'DBT_ETL_MART_SALES_CUSTOMER_DWH_ONE_TIME_LOAD'-%}
-- Step 1 Batch process info
{%- set v_watermark = edw_batch_control(v_dbt_job_name,config.get('schema'),config.get('alias') ,config.get('tags'),config.get('materialized') ) -%}
{%- set V_LWM = v_watermark[0] -%}
{%- set V_HWM = v_watermark[1] -%}
{%- set V_START_DTTM = v_watermark[2] -%}
{%- set V_BIW_BATCH_ID = v_watermark[3] -%}
{%- set v_sql_upd_success_batch = "CALL UTILITY.EDW_BATCH_SUCCESS_PROC('"~v_dbt_job_name~"')" -%}
{%- set V_EDW_DB = var('V_EDW_DEFAULT_DB') +env_var('DBT_DEP_ENV')+'.' -%}

{################# Snowflake Object Configuration #################}
{{
    config(
         description = 'Building ETL VIEW CUSTOMER Fact Historical DWH for Sales Mart '
        ,transient=true
        ,materialized='view'
        ,schema ='ETL_MART_SALES'
        ,alias='CUSTOMER_DWH_ONE_TIME_LOAD'
        ,tags =['MART_SALES']
        )
}}

WITH DWH_CUSTOMER AS (
    SELECT 
        CUST_KEY AS CUSTOMER_KEY ,
        CUST_CD AS CUSTOMER_CODE ,
        ERP_SITEUSE_ID as ERP_SITE_USE_ID ,
        ERP_STATUS AS ERP_STATUS ,
        CRM_CUSTOMER_OID AS CRM_CUSTOMER_OID ,
        CRM_STATUS AS CRM_STATUS ,
        CUST_NM AS CUSTOMER_NAME ,
        CUST_TYPE_CD AS CUSTOMER_TYPE_CODE ,
        CUST_TYPE_DESC AS CUSTOMER_TYPE_DESCRIPTION ,
        CUST_SOURCE AS CUSTOMER_SOURCE ,
        BUSINESS_CLASS_CD AS BUSINESS_CLASS_CODE ,
        CORP_CD AS CORPORATION_CODE ,
        CORP_DESC AS CORPORATION_DESCRIPTION ,
        END_CORP_CD AS END_CORPORATION_CODE ,
        END_CORP_DESC AS END_CORPORATION_DESCRIPTION ,
        SALES_TERRITORY_KEY,
        END_USE_CD AS END_USE_CODE ,
        END_USE_DESC AS END_USE_DESCRIPTION ,
        CURRENCY_CD AS CURRENCY_CODE ,
        ISO_CURRENCY_CD AS ISO_CURRENCY_CODE ,
        CREDIT_HOLD_FLG AS HAS_CREDIT_HOLD ,
        SERVICE_HOLD_FLG AS HAS_SERVICE_HOLD ,
        APPROVAL_FLG AS HAS_APPROVAL ,
        ORDRPROC_REGION_CD AS ORDER_PROCESSING_REGION_CODE ,
        CRD_SHPERLY_DY_QTY AS CRD_SHIP_EARLY_DAYS_QUANTITY ,
        CRD_PARTIAL_FLG AS HAS_CRD_PARTIAL ,
        SHIP_VIA_CD AS SHIP_VIA_CODE ,
        SHIP_TO_CRD_FLG AS HAS_SHIP_TO_CRD ,
        SHIP_LATE_DAYS_QTY AS SHIP_LATE_DAYS_QUANTITY ,
        BILL_CUST_CD AS BILL_CUSTOMER_CODE ,
        HANDLING_METHOD_CD AS HANDLING_METHOD_CODE ,
        HANDLING_METHOD_CD_DESC AS HANDLING_METHOD_CODE_DESCRIPTION ,
        EDI_CUSTOMER_FLG AS IS_EDI_CUSTOMER ,
        FINAL_DEST_DESC AS FINAL_DESTINATION_DESCRIPTION ,
        BILL_CNTRY_SRCE_CD AS BILL_COUNTRY_SOURCE_CODE ,
        FOB_OPTION_CD AS FOB_OPTION_CODE ,
        PAYMENT_TERM_CD AS PAYMENT_TERM_CODE ,
        FINCL_BANK_ID AS FINANCIAL_BANK_ID ,
        TRANSIT_DAYS_QTY AS TRANSIT_DAYS_QUANTITY ,
        DELIVERY_TYPE_CD AS DELIVERY_TYPE_CODE ,
        DATE_CODE_MAX_AGE_QTY AS DATE_CODE_MAXIMUM_AGE_QUANTITY ,
        CPN_REQUIRED_FLG AS IS_CPN_REQUIRED ,
        VAT_TAX_CD AS VAT_TAX_CODE ,
        MIN_DOLLAR_VALUE_AMT AS MINIMUM_DOLLAR_VALUE_AMOUNT ,
        MIN_DOLLAR_VALUE_VALID_FLG AS IS_MINIMUM_DOLLAR_VALUE_VALID ,
        CATEGORY_CD AS CORPORATION_CATEGORY_CODE ,
        CATEGORY_DESC AS CORPORATION_CATEGORY_DESCRIPTION ,
        CUSTOMER_ENTITY_CD AS CUSTOMER_ENTITY_CODE ,
        FORECAST_TYPE_CD AS FORECAST_TYPE_CODE ,
        FORECAST_CUSTOMER_FLG AS IS_FORECAST_CUSTOMER ,
        FORECAST_CUSTOMER_STATUS_CD AS FORECAST_CUSTOMER_STATUS_CODE ,
        REPLENISHMENT_CD AS REPLENISHMENT_CODE ,
        SERVICE_TYPE_CD AS SERVICE_TYPE_CODE ,
        CHG_ORD_APVL_REQRD_FLG AS CHANGE_ORDER_APROVAL_REQUIRED_CODE ,
        UDC_GENERIC_PROG_DESC AS UDC_GENERIC_PROG_DESCRIPTION ,
        CREATE_BY_ID AS CREATE_BY_ID ,
        CREATE_DTTM AS CREATE_DTTM ,
        LAST_UPD_BY_ID AS LAST_UPDATE_BY_ID ,
        LAST_UPD_DTTM AS LAST_UPDATE_DTTM ,
        'Y' AS IS_DELETED ,
        QUALITY_CD AS QUALITY_CODE ,
        FISCAL_ACCOUNT_NUM AS FISCAL_ACCOUNT_NUMBER ,
        CREDIT_LIMIT_AMT AS CREDIT_LIMIT_AMOUNT ,
        DIVISION AS DIVISION ,
        SALES_STRUCTURE AS SALES_STRUCTURE ,
        MARKET_SEGMENT_CD AS MARKET_SEGMENT_CODE ,
        ASSEMBLY_LOCATION_FLG AS IS_ASSEMBLY_LOCATION ,
        OPERATING_UNIT AS OPERATING_UNIT ,
        COF_CD AS COF_CODE ,
        COG_CD AS COG_CODE ,
        CUST_SHUT_DOWN_FROM_DT AS CUSTOMER_SHUT_DOWN_FROM_DATE ,
        CUST_SHUT_DOWN_TO_DT AS CUSTOMER_SHUT_DOWN_TO_DATE ,
        FOB_OPTION_DESC AS FOB_OPTION_DESCRIPTION ,
        TAX_CD AS TAX_CODE ,
        ORCL_ORDER_TYPE AS ORACLE_ORDER_TYPE ,
        ORCL_PAYMENT_TERM AS ORACLE_PAYMENT_TERM ,
        ORCL_SITE_STATUS AS ORACLE_SITE_STATUS ,
        ORCL_SITE_NBR AS ORACLE_SITE_NUMBER ,
        ORCL_SHIP_METHOD AS ORACLE_SHIP_METHOD ,
        FREE_TRADE_ZONE AS FREE_TRADE_ZONE ,
        COLLECTOR_NM AS COLLECTOR_NAME ,
        SHUTDOWN_FLG AS IS_SHUTDOWN ,
        CSR_USER_ID AS CSR_USER_ID ,
        FQA_USER_ID AS FQA_USER_ID 
    FROM 
        {{ source('STG_DWH_MARTS', 'CUSTOMER_DIM') }}   
    QUALIFY( ROW_NUMBER() OVER (PARTITION BY CUST_CD ORDER BY BIW_UPD_DTTM DESC)=1)
),
CONTACTS_DIM AS (
    SELECT 
        CUST_CD AS CUSTOMER_CODE,
        ROLE ,
        USER_ID ,
        FIRST_NM AS FIRST_NAME ,
        LAST_NM AS LAST_NAME ,
        EMAIL ,
        PHONE_DESC AS PHONE ,
        LAST_UPD_BY AS CONTACT_LAST_UPDATE_BY ,
        CREATED_BY AS CONTACT_CREATED_BY 
    FROM 
        {{ source('STG_DWH_MARTS', 'CUST_CONTACTS_DIM') }}
    QUALIFY( ROW_NUMBER() OVER (PARTITION BY CUST_CD,ROLE ORDER BY BIW_UPD_DTTM DESC)=1)   
),
SALES_LKP AS (
    SELECT 
        SALES_TERRITORY_KEY ,
        SALES_ORG_CD AS SALES_ORGANIZATION_CODE
    FROM 
        {{ source('STG_DWH_MARTS', 'SALES_TERRITORY_DIM') }}
    QUALIFY ROW_NUMBER() OVER (PARTITION BY SALES_TERRITORY_KEY ORDER BY BIW_UPD_DTTM DESC)=1 
),
DWH_ADDRESS AS (
    SELECT 
        CUST_CD AS CUSTOMER_CODE,
        ADDRESS_TYPE,
        ADDRESS1,
        ADDRESS2,
        ADDRESS3,
        ADDRESS4,
        CITY,
        STATE,
        ZIP,
        COUNTRY_CD,
        COUNTRY_DESC
    FROM 
    {{ source('STG_DWH_MARTS', 'ADDRESS_DIM') }}
    WHERE  ADDRESS_TYPE in ('BILL','SHIP')
    QUALIFY ROW_NUMBER() OVER (PARTITION BY CUST_CD,ADDRESS_TYPE ORDER BY BIW_UPD_DTTM DESC)=1 
),

FINAL_SQL AS (
    select 
    MD5(CUST.CUSTOMER_CODE) AS CUSTOMER_KEY ,
    -----------------FK CODE ----------------
    CUST.CUSTOMER_CODE ,
    CUST.BUSINESS_CLASS_CODE ,
    CUST.CORPORATION_CODE ,
    CUST.END_CORPORATION_CODE ,
    SAL.SALES_ORGANIZATION_CODE ,
    CUST.END_USE_CODE ,
    CUST.CURRENCY_CODE ,
    CUST.ISO_CURRENCY_CODE ,
    CUST.CUSTOMER_TYPE_CODE ,
    CUST.SHIP_VIA_CODE ,
    CUST.ORDER_PROCESSING_REGION_CODE ,
    CUST.BILL_CUSTOMER_CODE ,
    CUST.HANDLING_METHOD_CODE ,
    CUST.BILL_COUNTRY_SOURCE_CODE ,
    CUST.FOB_OPTION_CODE ,
    CUST.PAYMENT_TERM_CODE ,
    CUST.CORPORATION_CATEGORY_CODE ,
    CUST.VAT_TAX_CODE ,
    CUST.CUSTOMER_ENTITY_CODE ,
    CUST.FORECAST_TYPE_CODE ,
    CUST.FORECAST_CUSTOMER_STATUS_CODE ,
    CUST.REPLENISHMENT_CODE ,
    CUST.SERVICE_TYPE_CODE ,
    CUST.CHANGE_ORDER_APROVAL_REQUIRED_CODE ,
    CUST.QUALITY_CODE ,
    CUST.COF_CODE ,
    CUST.COG_CODE ,
    CUST.TAX_CODE ,
    CUST.MARKET_SEGMENT_CODE ,
    
    --------------------- FLAG ------------------
    COALESCE(CUST.IS_EDI_CUSTOMER,FALSE)::BOOLEAN AS IS_EDI_CUSTOMER ,
    COALESCE(CUST.IS_CPN_REQUIRED,FALSE)::BOOLEAN AS IS_CPN_REQUIRED ,
    COALESCE(CUST.IS_MINIMUM_DOLLAR_VALUE_VALID,FALSE)::BOOLEAN AS IS_MINIMUM_DOLLAR_VALUE_VALID ,
    COALESCE(CUST.IS_FORECAST_CUSTOMER,FALSE)::BOOLEAN AS IS_FORECAST_CUSTOMER ,
    COALESCE(CUST.IS_DELETED,FALSE)::BOOLEAN AS IS_DELETED ,
    COALESCE(CUST.IS_ASSEMBLY_LOCATION,FALSE)::BOOLEAN AS IS_ASSEMBLY_LOCATION ,
    COALESCE(CUST.IS_SHUTDOWN,FALSE)::BOOLEAN AS IS_SHUTDOWN ,
    COALESCE(CUST.HAS_CREDIT_HOLD,FALSE)::BOOLEAN AS HAS_CREDIT_HOLD ,
    COALESCE(CUST.HAS_SERVICE_HOLD,FALSE)::BOOLEAN AS HAS_SERVICE_HOLD ,
    COALESCE(CUST.HAS_APPROVAL,FALSE)::BOOLEAN AS HAS_APPROVAL ,
    COALESCE(CUST.HAS_CRD_PARTIAL,FALSE)::BOOLEAN AS HAS_CRD_PARTIAL ,
    COALESCE(CUST.HAS_SHIP_TO_CRD,FALSE)::BOOLEAN AS HAS_SHIP_TO_CRD ,
    
    -------------------- DESCRIPTION ---------------
    CUST.CORPORATION_DESCRIPTION ,
    CUST.END_CORPORATION_DESCRIPTION ,
    CUST.END_USE_DESCRIPTION ,
    CUST.CUSTOMER_TYPE_DESCRIPTION ,
    CUST.HANDLING_METHOD_CODE_DESCRIPTION ,
    CUST.FINAL_DESTINATION_DESCRIPTION ,
    CUST.CORPORATION_CATEGORY_DESCRIPTION ,
    CUST.UDC_GENERIC_PROG_DESCRIPTION ,
    CUST.FOB_OPTION_DESCRIPTION ,
    
    -------------------- OTHER ---------------------
    COALESCE(CUST.CUSTOMER_SOURCE,'HISTORY_DWH') AS CUSTOMER_SOURCE ,
    CUST.ERP_SITE_USE_ID ,
    CUST.ERP_STATUS ,
    CUST.CRM_CUSTOMER_OID ,
    CUST.CRM_STATUS ,
    CUST.CUSTOMER_NAME ,
    CUST.CRD_SHIP_EARLY_DAYS_QUANTITY ,
    CUST.SHIP_LATE_DAYS_QUANTITY ,
    CUST.FINANCIAL_BANK_ID ,
    CUST.TRANSIT_DAYS_QUANTITY ,
    CUST.DELIVERY_TYPE_CODE ,
    CUST.DATE_CODE_MAXIMUM_AGE_QUANTITY ,
    CUST.MINIMUM_DOLLAR_VALUE_AMOUNT ,
    CUST.CREATE_BY_ID ,
    CUST.CREATE_DTTM ,
    CUST.LAST_UPDATE_BY_ID ,
    CUST.LAST_UPDATE_DTTM ,
    CUST.FISCAL_ACCOUNT_NUMBER ,
    CUST.CREDIT_LIMIT_AMOUNT ,
    CUST.DIVISION ,
    CUST.SALES_STRUCTURE ,
    CUST.OPERATING_UNIT ,
    CUST.CUSTOMER_SHUT_DOWN_FROM_DATE ,
    CUST.CUSTOMER_SHUT_DOWN_TO_DATE ,
    CUST.ORACLE_ORDER_TYPE ,
    CUST.ORACLE_PAYMENT_TERM ,
    CUST.ORACLE_SITE_STATUS ,
    CUST.ORACLE_SITE_NUMBER ,
    CUST.ORACLE_SHIP_METHOD ,
    CUST.FREE_TRADE_ZONE ,
    CUST.COLLECTOR_NAME ,

  ----------------------- CSR -----------------------------
    CUST.CSR_USER_ID ,
    CSR.FIRST_NAME              AS CSR_FIRST_NAME ,
    CSR.LAST_NAME               AS CSR_LAST_NAME ,
    CSR.EMAIL                   AS CSR_EMAIL ,
    CSR.PHONE                   AS CSR_PHONE ,
    CSR.CONTACT_LAST_UPDATE_BY  AS CSR_CONTACT_LAST_UPDATE_BY ,
    CSR.CONTACT_CREATED_BY      AS CSR_CONTACT_CREATED_BY ,
    ----------------------- FAQ -----------------------------
    FAQ.USER_ID                 AS FQA_USER_ID ,
    FAQ.FIRST_NAME              AS FQA_FIRST_NAME ,
    FAQ.LAST_NAME               AS FQA_LAST_NAME ,
    FAQ.EMAIL                   AS FQA_EMAIL ,
    FAQ.PHONE                   AS FQA_PHONE ,
    FAQ.CONTACT_LAST_UPDATE_BY  AS FQA_CONTACT_LAST_UPDATE_BY ,
    FAQ.CONTACT_CREATED_BY      AS FQA_CONTACT_CREATED_BY ,
    ----------------------- BUYER -----------------------------
    BUY.USER_ID                 AS BUYER_USER_ID ,
    BUY.FIRST_NAME              AS BUYER_FIRST_NAME ,
    BUY.LAST_NAME               AS BUYER_LAST_NAME ,
    BUY.EMAIL                   AS BUYER_EMAIL ,
    BUY.PHONE                   AS BUYER_PHONE ,
    BUY.CONTACT_LAST_UPDATE_BY  AS BUYER_CONTACT_LAST_UPDATE_BY ,
    BUY.CONTACT_CREATED_BY      AS BUYER_CONTACT_CREATED_BY ,
    ----------------------- FSE -----------------------------
    FSE.USER_ID                 AS FSE_USER_ID ,
    FSE.FIRST_NAME              AS FSE_FIRST_NAME ,
    FSE.LAST_NAME               AS FSE_LAST_NAME ,
    FSE.EMAIL                   AS FSE_EMAIL ,
    FSE.PHONE                   AS FSE_PHONE ,
    FSE.CONTACT_LAST_UPDATE_BY  AS FSE_CONTACT_LAST_UPDATE_BY ,
    FSE.CONTACT_CREATED_BY      AS FSE_CONTACT_CREATED_BY ,
    ADDR_SHIP.ADDRESS1 AS SHIP_ADDRESS_LINE1,
    ADDR_SHIP.ADDRESS2 AS SHIP_ADDRESS_LINE2,
    ADDR_SHIP.ADDRESS3 AS SHIP_ADDRESS_LINE3,
    ADDR_SHIP.ADDRESS4 AS SHIP_ADDRESS_LINE4,
    ADDR_SHIP.ZIP AS SHIP_ADDRESS_POSTAL_CODE,
    ADDR_SHIP.COUNTRY_CD AS SHIP_ADDRESS_COUNTRY_CODE,
    ADDR_SHIP.COUNTRY_DESC AS SHIP_ADDRESS_COUNTRY_NAME,
    ADDR_SHIP.STATE AS SHIP_ADDRESS_STATE,
    ADDR_SHIP.CITY AS SHIP_ADDRESS_CITY,
    ADDR_BILL.ADDRESS1 AS BILL_ADDRESS_LINE1,
    ADDR_BILL.ADDRESS2 AS BILL_ADDRESS_LINE2,
    ADDR_BILL.ADDRESS3 AS BILL_ADDRESS_LINE3,
    ADDR_BILL.ADDRESS4 AS BILL_ADDRESS_LINE4,
    ADDR_BILL.ZIP AS BILL_ADDRESS_POSTAL_CODE,
    ADDR_BILL.COUNTRY_CD AS BILL_ADDRESS_COUNTRY_CODE,
    ADDR_BILL.COUNTRY_DESC AS BILL_ADDRESS_COUNTRY_NAME,
    ADDR_BILL.STATE AS BILL_ADDRESS_STATE,
    ADDR_BILL.CITY AS BILL_ADDRESS_CITY,
    '{{V_START_DTTM}}'::TIMESTAMP_NTZ BIW_INS_DTTM ,
    '{{V_START_DTTM}}'::TIMESTAMP_NTZ BIW_UPD_DTTM ,
    {{V_BIW_BATCH_ID}} as BIW_BATCH_ID
    FROM
    DWH_CUSTOMER CUST
    LEFT JOIN CONTACTS_DIM AS CSR 
        ON CUST.CUSTOMER_CODE = CSR.CUSTOMER_CODE     
        AND CSR.ROLE= 'CSR'
    LEFT JOIN CONTACTS_DIM AS FAQ 
        ON CUST.CUSTOMER_CODE = FAQ.CUSTOMER_CODE     
        AND FAQ.ROLE= 'FQA'
    LEFT JOIN CONTACTS_DIM AS BUY 
        ON CUST.CUSTOMER_CODE = BUY.CUSTOMER_CODE     
        AND BUY.ROLE= 'BUYER'
    LEFT JOIN CONTACTS_DIM AS FSE 
        ON CUST.CUSTOMER_CODE = FSE.CUSTOMER_CODE     
        AND FSE.ROLE= 'FSE'
    LEFT JOIN SALES_LKP AS SAL 
        ON CUST.SALES_TERRITORY_KEY = SAL.SALES_TERRITORY_KEY
    LEFT JOIN DWH_ADDRESS ADDR_BILL 
        ON CUST.CUSTOMER_CODE = ADDR_BILL.CUSTOMER_CODE 
        AND ADDR_BILL.ADDRESS_TYPE = 'BILL'
    LEFT JOIN DWH_ADDRESS ADDR_SHIP 
        ON CUST.CUSTOMER_CODE = ADDR_SHIP.CUSTOMER_CODE 
        AND ADDR_SHIP.ADDRESS_TYPE = 'SHIP'
)
SELECT 
    FIN.* ,
    md5(object_construct ('col1',CUSTOMER_CODE::string, 'col2',BUSINESS_CLASS_CODE::string,
'col3',CORPORATION_CODE::string, 'col4',END_CORPORATION_CODE::string, 'col5',SALES_ORGANIZATION_CODE::string,
'col6',END_USE_CODE::string, 'col7',CURRENCY_CODE::string, 'col8',ISO_CURRENCY_CODE::string, 'col9',CUSTOMER_TYPE_CODE::string,
'col10',SHIP_VIA_CODE::string, 'col11',ORDER_PROCESSING_REGION_CODE::string, 'col12',BILL_CUSTOMER_CODE::string,
'col13',HANDLING_METHOD_CODE::string, 'col14',BILL_COUNTRY_SOURCE_CODE::string, 'col15',FOB_OPTION_CODE::string,
'col16',PAYMENT_TERM_CODE::string, 'col17',CORPORATION_CATEGORY_CODE::string, 'col18',VAT_TAX_CODE::string,
'col19',CUSTOMER_ENTITY_CODE::string, 'col20',FORECAST_TYPE_CODE::string, 'col21',FORECAST_CUSTOMER_STATUS_CODE::string,
'col22',REPLENISHMENT_CODE::string, 'col23',SERVICE_TYPE_CODE::string, 'col24',CHANGE_ORDER_APROVAL_REQUIRED_CODE::string,
'col25',QUALITY_CODE::string, 'col26',COF_CODE::string, 'col27',COG_CODE::string, 'col28',TAX_CODE::string,
'col29',MARKET_SEGMENT_CODE::string, 'col30',IS_EDI_CUSTOMER::string, 'col31',IS_CPN_REQUIRED::string,
'col32',IS_MINIMUM_DOLLAR_VALUE_VALID::string, 'col33',IS_FORECAST_CUSTOMER::string, 'col34',IS_DELETED::string,
'col35',IS_ASSEMBLY_LOCATION::string, 'col36',IS_SHUTDOWN::string, 'col37',HAS_CREDIT_HOLD::string, 'col38',HAS_SERVICE_HOLD::string,
'col39',HAS_APPROVAL::string, 'col40',HAS_CRD_PARTIAL::string, 'col41',HAS_SHIP_TO_CRD::string,
'col42',CORPORATION_DESCRIPTION::string, 'col43',END_CORPORATION_DESCRIPTION::string, 'col44',END_USE_DESCRIPTION::string,
'col45',CUSTOMER_TYPE_DESCRIPTION::string, 'col46',HANDLING_METHOD_CODE_DESCRIPTION::string, 'col47',FINAL_DESTINATION_DESCRIPTION::string,
'col48',CORPORATION_CATEGORY_DESCRIPTION::string, 'col49',UDC_GENERIC_PROG_DESCRIPTION::string, 'col50',FOB_OPTION_DESCRIPTION::string,
'col51',CUSTOMER_SOURCE::string, 'col52',ERP_SITE_USE_ID::string, 'col53',ERP_STATUS::string, 'col54',CRM_CUSTOMER_OID::string,
'col55',CRM_STATUS::string, 'col56',CUSTOMER_NAME::string, 'col57',CRD_SHIP_EARLY_DAYS_QUANTITY::string,
'col58',SHIP_LATE_DAYS_QUANTITY::string, 'col59',FINANCIAL_BANK_ID::string, 'col60',TRANSIT_DAYS_QUANTITY::string,
'col61',DELIVERY_TYPE_CODE::string, 'col62',DATE_CODE_MAXIMUM_AGE_QUANTITY::string, 'col63',MINIMUM_DOLLAR_VALUE_AMOUNT::string,
'col64',CREATE_BY_ID::string, 'col65',CREATE_DTTM::string, 'col66',LAST_UPDATE_BY_ID::string, 'col67',LAST_UPDATE_DTTM::string,
'col68',FISCAL_ACCOUNT_NUMBER::string, 'col69',CREDIT_LIMIT_AMOUNT::string, 'col70',DIVISION::string, 'col71',SALES_STRUCTURE::string,
'col72',OPERATING_UNIT::string, 'col73',CUSTOMER_SHUT_DOWN_FROM_DATE::string, 'col74',CUSTOMER_SHUT_DOWN_TO_DATE::string,
'col75',ORACLE_ORDER_TYPE::string, 'col76',ORACLE_PAYMENT_TERM::string, 'col77',ORACLE_SITE_STATUS::string,
'col78',ORACLE_SITE_NUMBER::string, 'col79',ORACLE_SHIP_METHOD::string, 'col80',FREE_TRADE_ZONE::string,
'col81',COLLECTOR_NAME::string, 'col82',CSR_USER_ID::string, 'col83',CSR_FIRST_NAME::string, 'col84',CSR_LAST_NAME::string,
'col85',CSR_EMAIL::string, 'col86',CSR_PHONE::string, 'col87',CSR_CONTACT_LAST_UPDATE_BY::string,
'col88',CSR_CONTACT_CREATED_BY::string, 'col89',FQA_USER_ID::string, 'col90',FQA_FIRST_NAME::string, 'col91',FQA_LAST_NAME::string,
'col92',FQA_EMAIL::string, 'col93',FQA_PHONE::string, 'col94',FQA_CONTACT_LAST_UPDATE_BY::string,
'col95',FQA_CONTACT_CREATED_BY::string, 'col96',BUYER_USER_ID::string, 'col97',BUYER_FIRST_NAME::string, 'col98',BUYER_LAST_NAME::string,
'col99',BUYER_EMAIL::string, 'col100',BUYER_PHONE::string, 'col101',BUYER_CONTACT_LAST_UPDATE_BY::string,
'col102',BUYER_CONTACT_CREATED_BY::string, 'col103',FSE_USER_ID::string, 'col104',FSE_FIRST_NAME::string, 'col105',FSE_LAST_NAME::string,
'col106',FSE_EMAIL::string, 'col107',FSE_PHONE::string, 'col108',FSE_CONTACT_LAST_UPDATE_BY::string,
'col109',FSE_CONTACT_CREATED_BY::string, 'col110',SHIP_ADDRESS_LINE1::string, 'col111',SHIP_ADDRESS_LINE2::string,
'col112',SHIP_ADDRESS_LINE3::string, 'col113',SHIP_ADDRESS_LINE4::string, 'col114',SHIP_ADDRESS_POSTAL_CODE::string,
'col115',SHIP_ADDRESS_COUNTRY_CODE::string, 'col116',SHIP_ADDRESS_COUNTRY_NAME::string, 'col117',SHIP_ADDRESS_STATE::string,
'col118',SHIP_ADDRESS_CITY::string, 'col119',BILL_ADDRESS_LINE1::string, 'col120',BILL_ADDRESS_LINE2::string,
'col121',BILL_ADDRESS_LINE3::string, 'col122',BILL_ADDRESS_LINE4::string, 'col123',BILL_ADDRESS_POSTAL_CODE::string,
'col124',BILL_ADDRESS_COUNTRY_CODE::string, 'col125',BILL_ADDRESS_COUNTRY_NAME::string, 'col126',BILL_ADDRESS_STATE::string,
'col127',BILL_ADDRESS_CITY::string)::string )::BINARY as BIW_MD5_KEY
FROM    
    FINAL_SQL as FIN