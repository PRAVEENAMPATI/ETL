    /*---------------------------------------------------------------------------
Command to run model:
--dbt build --select ETL_MART_SALES_CUSTOMER

Version     Date            Author               Description
-------     --------        -----------          ----------------------------------
1.0         01/23/2023      Vinay Subramanian    Initial Version
2.0         02/16/2023      Vinay Subramanian    Added BIll and Ship address columns
---------------------------------------------------------------------------*/
{################# EDW Job Template Variables #################}
{%-set v_pk_list = ['CUSTOMER_CODE']-%}
{% if is_incremental() %}
{%-set v_house_keeping_column = ['BIW_INS_DTTM','BIW_UPD_DTTM','BIW_BATCH_ID','BIW_MD5_KEY']-%}
{%-set v_all_column_list =  edw_get_column_list( this ) -%}
{%-set v_update_column_list =  edw_get_quoted_column_list( this ,v_pk_list|list + ['BIW_INS_DTTM']|list) -%}
{%-set v_md5_column_list =  edw_get_md5_column_list( this ,v_pk_list|list+ v_house_keeping_column|list ) -%}
--DBT Variable
--SELECT {{v_all_column_list}}
--SELECT {{v_update_column_list}}
--SELECT {{v_md5_column_list}}
{% endif %}

{################# Batch control insert and update SQL #################}
{%- set v_dbt_job_name = 'DBT_ETL_MART_SALES_CUSTOMER'-%}
-- Step 1 Batch process info
{%- set v_watermark = edw_batch_control(v_dbt_job_name,config.get('schema'),config.get('alias') ,config.get('tags'),config.get('materialized') ) -%}
{%- set V_LWM = v_watermark[0] -%}
{%- set V_HWM = v_watermark[1] -%}
{%- set V_START_DTTM = v_watermark[2] -%}
{%- set V_BIW_BATCH_ID = v_watermark[3] -%}
{%- set v_sql_upd_success_batch = "CALL UTILITY.EDW_BATCH_SUCCESS_PROC('"~v_dbt_job_name~"')" -%}

{{
    config(
         description = 'Building etl table CUSTOMER for sales mart '
        ,transient=true
        ,materialized='table'
        ,schema ='ETL_MART_SALES'
        ,alias='CUSTOMER'
        ,tags ='MART_SALES'
        ,post_hook= [v_sql_upd_success_batch]
        )
}}

WITH CUSTOMER_EBS AS (
    SELECT
        CUSTOMER_CODE,
        ERP_SITE_USE_ID,
        ERP_STATUS,
        CRM_CUSTOMER_OID,
        CRM_STATUS,
        CUSTOMER_NAME,
        CUSTOMER_TYPE_CODE,
        CUSTOMER_TYPE_DESCRIPTION,
        CUSTOMER_SOURCE,
        BUSINESS_CLASS_CODE,
        CORPORATION_CODE,
        CORPORATION_DESCRIPTION,
        END_CORPORATION_CODE,
        END_CORPORATION_DESCRIPTION,
        SALES_ORGANIZATION_CODE,
        END_USE_CODE,
        END_USE_DESCRIPTION,
        CURRENCY_CODE,
        ISO_CURRENCY_CODE,
        HAS_CREDIT_HOLD,
        HAS_SERVICE_HOLD,
        HAS_APPROVAL,
        ORDER_PROCESSING_REGION_CODE,
        CRD_SHIP_EARLY_DAYS_QUANTITY,
        HAS_CRD_PARTIAL,
        SHIP_VIA_CODE,
        HAS_SHIP_TO_CRD,
        SHIP_LATE_DAYS_QUANTITY,
        BILL_CUSTOMER_CODE,
        HANDLING_METHOD_CODE,
        HANDLING_METHOD_CODE_DESCRIPTION,
        IS_EDI_CUSTOMER,
        FINAL_DESTINATION_DESCRIPTION,
        BILL_COUNTRY_SOURCE_CODE,
        FOB_OPTION_CODE,
        PAYMENT_TERM_CODE,
        FINANCIAL_BANK_ID,
        TRANSIT_DAYS_QUANTITY,
        DELIVERY_TYPE_CODE,
        DATE_CODE_MAXIMUM_AGE_QUANTITY,
        IS_CPN_REQUIRED,
        VAT_TAX_CODE,
        MINIMUM_DOLLAR_VALUE_AMOUNT,
        IS_MINIMUM_DOLLAR_VALUE_VALID,
        CORPORATION_CATEGORY_CODE,
        CORPORATION_CATEGORY_DESCRIPTION,
        CUSTOMER_ENTITY_CODE,
        FORECAST_TYPE_CODE,
        IS_FORECAST_CUSTOMER,
        FORECAST_CUSTOMER_STATUS_CODE,
        REPLENISHMENT_CODE,
        SERVICE_TYPE_CODE,
        CHANGE_ORDER_APROVAL_REQUIRED_CODE,
        UDC_GENERIC_PROG_DESCRIPTION,
        CREATE_BY_ID,
        CREATE_DTTM,
        LAST_UPDATE_BY_ID,
        LAST_UPDATE_DTTM,
        IS_DELETED,
        QUALITY_CODE,
        FISCAL_ACCOUNT_NUMBER,
        CREDIT_LIMIT_AMOUNT,
        DIVISION,
        SALES_STRUCTURE,
        MARKET_SEGMENT_CODE,
        IS_ASSEMBLY_LOCATION,
        OPERATING_UNIT,
        COF_CODE,
        COG_CODE,
        CUSTOMER_SHUT_DOWN_FROM_DATE,
        CUSTOMER_SHUT_DOWN_TO_DATE,
        FOB_OPTION_DESCRIPTION,
        TAX_CODE,
        ORACLE_ORDER_TYPE,
        ORACLE_PAYMENT_TERM,
        ORACLE_SITE_STATUS,
        ORACLE_SITE_NUMBER,
        ORACLE_SHIP_METHOD,
        FREE_TRADE_ZONE,
        COLLECTOR_NAME,
        IS_SHUTDOWN,
        CSR_USER_ID,
        CSR_FIRST_NAME,
        CSR_LAST_NAME,
        CSR_EMAIL,
        CSR_PHONE,
        CSR_CONTACT_LAST_UPDATE_BY,
        CSR_CONTACT_CREATED_BY,
        FQA_USER_ID,
        FQA_FIRST_NAME,
        FQA_LAST_NAME,
        FQA_EMAIL,
        FQA_PHONE,
        FQA_CONTACT_LAST_UPDATE_BY,
        FQA_CONTACT_CREATED_BY,
        BUYER_USER_ID,
        BUYER_FIRST_NAME,
        BUYER_LAST_NAME,
        BUYER_EMAIL,
        BUYER_PHONE,
        BUYER_CONTACT_LAST_UPDATE_BY,
        BUYER_CONTACT_CREATED_BY,
        FSE_USER_ID,
        FSE_FIRST_NAME,
        FSE_LAST_NAME,
        FSE_EMAIL,
        FSE_PHONE,
        FSE_CONTACT_LAST_UPDATE_BY,
        FSE_CONTACT_CREATED_BY,
        SHIP_ADDRESS_LINE1,
        SHIP_ADDRESS_LINE2,
        SHIP_ADDRESS_LINE3,
        SHIP_ADDRESS_LINE4,
        SHIP_ADDRESS_POSTAL_CODE,
        SHIP_ADDRESS_COUNTRY_CODE,
        SHIP_ADDRESS_COUNTRY_NAME,
        SHIP_ADDRESS_STATE,
        SHIP_ADDRESS_CITY,
        BILL_ADDRESS_LINE1,
        BILL_ADDRESS_LINE2,
        BILL_ADDRESS_LINE3,
        BILL_ADDRESS_LINE4,
        BILL_ADDRESS_POSTAL_CODE,
        BILL_ADDRESS_COUNTRY_CODE,
        BILL_ADDRESS_COUNTRY_NAME,
        BILL_ADDRESS_STATE,
        BILL_ADDRESS_CITY,
        BIW_INS_DTTM,
        BIW_UPD_DTTM,
        BIW_BATCH_ID
    FROM 
    {{ref('ETL_MART_SALES_CUSTOMER_EBS')}}
)

,CUSTOMER_MODELN AS (
    SELECT
        CUSTOMER_CODE,
        ERP_STATUS,
        CRM_CUSTOMER_OID,
        CRM_STATUS,
        CUSTOMER_NAME,
        CUSTOMER_SOURCE,
        BUSINESS_CLASS_CODE,
        CORPORATION_CODE,
        CORPORATION_DESCRIPTION,
        END_CORPORATION_CODE,
        END_CORPORATION_DESCRIPTION,
        SALES_ORGANIZATION_CODE,
        END_USE_CODE,
        END_USE_DESCRIPTION,
        CURRENCY_CODE,
        ISO_CURRENCY_CODE,
        HAS_APPROVAL,
        ORDER_PROCESSING_REGION_CODE,
        CORPORATION_CATEGORY_CODE,
        CORPORATION_CATEGORY_DESCRIPTION,
        CUSTOMER_ENTITY_CODE,
        UDC_GENERIC_PROG_DESCRIPTION,
        CREATE_BY_ID,
        CREATE_DTTM,
        LAST_UPDATE_BY_ID,
        LAST_UPDATE_DTTM,
        IS_DELETED,
        DIVISION,
        SALES_STRUCTURE,
        MARKET_SEGMENT_CODE,
        COF_CODE,
        COG_CODE,
        FSE_USER_ID,
        FSE_FIRST_NAME,
        FSE_LAST_NAME,
        FSE_EMAIL,
        FSE_PHONE,
        FSE_CONTACT_LAST_UPDATE_BY,
        FSE_CONTACT_CREATED_BY,
        SHIP_ADDRESS_LINE1,
        SHIP_ADDRESS_LINE2,
        SHIP_ADDRESS_LINE3,
        SHIP_ADDRESS_LINE4,
        SHIP_ADDRESS_POSTAL_CODE,
        SHIP_ADDRESS_COUNTRY_CODE,
        SHIP_ADDRESS_COUNTRY_NAME,
        SHIP_ADDRESS_STATE,
        SHIP_ADDRESS_CITY,
        BILL_ADDRESS_LINE1,
        BILL_ADDRESS_LINE2,
        BILL_ADDRESS_LINE3,
        BILL_ADDRESS_LINE4,
        BILL_ADDRESS_POSTAL_CODE,
        BILL_ADDRESS_COUNTRY_CODE,
        BILL_ADDRESS_COUNTRY_NAME,
        BILL_ADDRESS_STATE,
        BILL_ADDRESS_CITY,
        BIW_INS_DTTM,
        BIW_UPD_DTTM,
        BIW_BATCH_ID
    FROM 
    {{ref('ETL_MART_SALES_CUSTOMER_MODELN')}}
)

,FINAL_SQL as (
    SELECT
        COALESCE(MDLN.CUSTOMER_CODE,EBS.CUSTOMER_CODE ) AS CUSTOMER_CODE,
        EBS.ERP_SITE_USE_ID,
        COALESCE(MDLN.ERP_STATUS,EBS.ERP_STATUS ) AS ERP_STATUS,
        COALESCE(MDLN.CRM_CUSTOMER_OID,EBS.CRM_CUSTOMER_OID ) AS CRM_CUSTOMER_OID,
        COALESCE(MDLN.CRM_STATUS,EBS.CRM_STATUS ) AS CRM_STATUS,
        COALESCE(MDLN.CUSTOMER_NAME,EBS.CUSTOMER_NAME ) AS CUSTOMER_NAME,
        EBS.CUSTOMER_TYPE_CODE,
        EBS.CUSTOMER_TYPE_DESCRIPTION,
        COALESCE(MDLN.CUSTOMER_SOURCE,EBS.CUSTOMER_SOURCE ) AS CUSTOMER_SOURCE,
        COALESCE(MDLN.BUSINESS_CLASS_CODE,EBS.BUSINESS_CLASS_CODE ) AS BUSINESS_CLASS_CODE,
        COALESCE(MDLN.CORPORATION_CODE,EBS.CORPORATION_CODE ) AS CORPORATION_CODE,
        COALESCE(MDLN.CORPORATION_DESCRIPTION,EBS.CORPORATION_DESCRIPTION ) AS CORPORATION_DESCRIPTION,
        COALESCE(MDLN.END_CORPORATION_CODE,EBS.END_CORPORATION_CODE ) AS END_CORPORATION_CODE,
        COALESCE(MDLN.END_CORPORATION_DESCRIPTION,EBS.END_CORPORATION_DESCRIPTION ) AS END_CORPORATION_DESCRIPTION,
        COALESCE(MDLN.SALES_ORGANIZATION_CODE,EBS.SALES_ORGANIZATION_CODE ) AS SALES_ORGANIZATION_CODE,
        COALESCE(MDLN.END_USE_CODE,EBS.END_USE_CODE ) AS END_USE_CODE,
        COALESCE(MDLN.END_USE_DESCRIPTION,EBS.END_USE_DESCRIPTION ) AS END_USE_DESCRIPTION,
        COALESCE(MDLN.CURRENCY_CODE,EBS.CURRENCY_CODE ) AS CURRENCY_CODE,
        COALESCE(MDLN.ISO_CURRENCY_CODE,EBS.ISO_CURRENCY_CODE ) AS ISO_CURRENCY_CODE,
        COALESCE(TRY_TO_BOOLEAN(EBS.HAS_CREDIT_HOLD),'FALSE')::BOOLEAN AS HAS_CREDIT_HOLD,
        COALESCE(TRY_TO_BOOLEAN(EBS.HAS_SERVICE_HOLD),'FALSE')::BOOLEAN AS HAS_SERVICE_HOLD,
        COALESCE(MDLN.HAS_APPROVAL,EBS.HAS_APPROVAL)::BOOLEAN AS HAS_APPROVAL,
        COALESCE(MDLN.ORDER_PROCESSING_REGION_CODE,EBS.ORDER_PROCESSING_REGION_CODE ) AS ORDER_PROCESSING_REGION_CODE,
        EBS.CRD_SHIP_EARLY_DAYS_QUANTITY,
        COALESCE(TRY_TO_BOOLEAN(EBS.HAS_CRD_PARTIAL),'FALSE')::BOOLEAN AS HAS_CRD_PARTIAL,
        EBS.SHIP_VIA_CODE,
        COALESCE(TRY_TO_BOOLEAN(EBS.HAS_SHIP_TO_CRD),'FALSE')::BOOLEAN AS HAS_SHIP_TO_CRD,
        EBS.SHIP_LATE_DAYS_QUANTITY,
        EBS.BILL_CUSTOMER_CODE,
        EBS.HANDLING_METHOD_CODE,
        EBS.HANDLING_METHOD_CODE_DESCRIPTION,
        COALESCE(TRY_TO_BOOLEAN(EBS.IS_EDI_CUSTOMER),'FALSE')::BOOLEAN AS IS_EDI_CUSTOMER,
        EBS.FINAL_DESTINATION_DESCRIPTION,
        EBS.BILL_COUNTRY_SOURCE_CODE,
        EBS.FOB_OPTION_CODE,
        EBS.PAYMENT_TERM_CODE,
        EBS.FINANCIAL_BANK_ID,
        EBS.TRANSIT_DAYS_QUANTITY,
        EBS.DELIVERY_TYPE_CODE,
        EBS.DATE_CODE_MAXIMUM_AGE_QUANTITY,
        COALESCE(TRY_TO_BOOLEAN(EBS.IS_CPN_REQUIRED),'FALSE')::BOOLEAN AS IS_CPN_REQUIRED,
        EBS.VAT_TAX_CODE,
        EBS.MINIMUM_DOLLAR_VALUE_AMOUNT,
        COALESCE(TRY_TO_BOOLEAN(EBS.IS_MINIMUM_DOLLAR_VALUE_VALID),'FALSE')::BOOLEAN AS IS_MINIMUM_DOLLAR_VALUE_VALID,
        COALESCE(MDLN.CORPORATION_CATEGORY_CODE,EBS.CORPORATION_CATEGORY_CODE ) AS CORPORATION_CATEGORY_CODE,
        COALESCE(MDLN.CORPORATION_CATEGORY_DESCRIPTION,EBS.CORPORATION_CATEGORY_DESCRIPTION ) AS CORPORATION_CATEGORY_DESCRIPTION,
        COALESCE(MDLN.CUSTOMER_ENTITY_CODE,EBS.CUSTOMER_ENTITY_CODE ) AS CUSTOMER_ENTITY_CODE,
        EBS.FORECAST_TYPE_CODE,
        COALESCE(TRY_TO_BOOLEAN(EBS.IS_FORECAST_CUSTOMER),'FALSE')::BOOLEAN AS IS_FORECAST_CUSTOMER,
        EBS.FORECAST_CUSTOMER_STATUS_CODE,
        EBS.REPLENISHMENT_CODE,
        EBS.SERVICE_TYPE_CODE,
        EBS.CHANGE_ORDER_APROVAL_REQUIRED_CODE,
        COALESCE(MDLN.UDC_GENERIC_PROG_DESCRIPTION,EBS.UDC_GENERIC_PROG_DESCRIPTION ) AS UDC_GENERIC_PROG_DESCRIPTION,
        COALESCE(MDLN.CREATE_BY_ID,EBS.CREATE_BY_ID ) AS CREATE_BY_ID,
        COALESCE(MDLN.CREATE_DTTM,EBS.CREATE_DTTM ) AS CREATE_DTTM,
        COALESCE(MDLN.LAST_UPDATE_BY_ID,EBS.LAST_UPDATE_BY_ID ) AS LAST_UPDATE_BY_ID,
        COALESCE(MDLN.LAST_UPDATE_DTTM,EBS.LAST_UPDATE_DTTM ) AS LAST_UPDATE_DTTM,
        TRY_TO_BOOLEAN(COALESCE(MDLN.IS_DELETED,EBS.IS_DELETED,'FALSE') )::BOOLEAN AS IS_DELETED,
        EBS.QUALITY_CODE,
        EBS.FISCAL_ACCOUNT_NUMBER,
        EBS.CREDIT_LIMIT_AMOUNT,
        COALESCE(MDLN.DIVISION,EBS.DIVISION ) AS DIVISION,
        COALESCE(MDLN.SALES_STRUCTURE,EBS.SALES_STRUCTURE ) AS SALES_STRUCTURE,
        COALESCE(MDLN.MARKET_SEGMENT_CODE,EBS.MARKET_SEGMENT_CODE ) AS MARKET_SEGMENT_CODE,
        COALESCE(TRY_TO_BOOLEAN(EBS.IS_ASSEMBLY_LOCATION),'FALSE')::BOOLEAN AS IS_ASSEMBLY_LOCATION,
        EBS.OPERATING_UNIT,
        COALESCE(MDLN.COF_CODE,EBS.COF_CODE ) AS COF_CODE,
        COALESCE(MDLN.COG_CODE,EBS.COG_CODE ) AS COG_CODE,
        EBS.CUSTOMER_SHUT_DOWN_FROM_DATE,
        EBS.CUSTOMER_SHUT_DOWN_TO_DATE,
        EBS.FOB_OPTION_DESCRIPTION,
        EBS.TAX_CODE,
        EBS.ORACLE_ORDER_TYPE,
        EBS.ORACLE_PAYMENT_TERM,
        EBS.ORACLE_SITE_STATUS,
        EBS.ORACLE_SITE_NUMBER,
        EBS.ORACLE_SHIP_METHOD,
        EBS.FREE_TRADE_ZONE,
        EBS.COLLECTOR_NAME,
        COALESCE(TRY_TO_BOOLEAN(EBS.IS_SHUTDOWN),'FALSE')::BOOLEAN AS IS_SHUTDOWN,
        EBS.CSR_USER_ID,
        EBS.CSR_FIRST_NAME,
        EBS.CSR_LAST_NAME,
        EBS.CSR_EMAIL,
        EBS.CSR_PHONE,
        EBS.CSR_CONTACT_LAST_UPDATE_BY,
        EBS.CSR_CONTACT_CREATED_BY,
        EBS.FQA_USER_ID,
        EBS.FQA_FIRST_NAME,
        EBS.FQA_LAST_NAME,
        EBS.FQA_EMAIL,
        EBS.FQA_PHONE,
        EBS.FQA_CONTACT_LAST_UPDATE_BY,
        EBS.FQA_CONTACT_CREATED_BY,
        EBS.BUYER_USER_ID,
        EBS.BUYER_FIRST_NAME,
        EBS.BUYER_LAST_NAME,
        EBS.BUYER_EMAIL,
        EBS.BUYER_PHONE,
        EBS.BUYER_CONTACT_LAST_UPDATE_BY,
        EBS.BUYER_CONTACT_CREATED_BY,
        COALESCE(MDLN.FSE_USER_ID,EBS.FSE_USER_ID ) AS FSE_USER_ID,
        COALESCE(MDLN.FSE_FIRST_NAME,EBS.FSE_FIRST_NAME ) AS FSE_FIRST_NAME,
        COALESCE(MDLN.FSE_LAST_NAME,EBS.FSE_LAST_NAME ) AS FSE_LAST_NAME,
        COALESCE(MDLN.FSE_EMAIL,EBS.FSE_EMAIL ) AS FSE_EMAIL,
        COALESCE(MDLN.FSE_PHONE,EBS.FSE_PHONE ) AS FSE_PHONE,
        COALESCE(MDLN.FSE_CONTACT_LAST_UPDATE_BY,EBS.FSE_CONTACT_LAST_UPDATE_BY ) AS FSE_CONTACT_LAST_UPDATE_BY,
        COALESCE(MDLN.FSE_CONTACT_CREATED_BY,EBS.FSE_CONTACT_CREATED_BY ) AS FSE_CONTACT_CREATED_BY,
        COALESCE(MDLN.SHIP_ADDRESS_LINE1,EBS.SHIP_ADDRESS_LINE1) AS SHIP_ADDRESS_LINE1,
        COALESCE(MDLN.SHIP_ADDRESS_LINE2,EBS.SHIP_ADDRESS_LINE2) AS SHIP_ADDRESS_LINE2,
        COALESCE(MDLN.SHIP_ADDRESS_LINE3,EBS.SHIP_ADDRESS_LINE3) AS SHIP_ADDRESS_LINE3, 
        COALESCE(MDLN.SHIP_ADDRESS_LINE4,EBS.SHIP_ADDRESS_LINE4) AS SHIP_ADDRESS_LINE4,
        COALESCE(MDLN.SHIP_ADDRESS_POSTAL_CODE,EBS.SHIP_ADDRESS_POSTAL_CODE) AS SHIP_ADDRESS_POSTAL_CODE,
        COALESCE(MDLN.SHIP_ADDRESS_COUNTRY_CODE,EBS.SHIP_ADDRESS_COUNTRY_CODE) AS SHIP_ADDRESS_COUNTRY_CODE,
        COALESCE(MDLN.SHIP_ADDRESS_COUNTRY_NAME,EBS.SHIP_ADDRESS_COUNTRY_NAME) AS SHIP_ADDRESS_COUNTRY_NAME,
        COALESCE(MDLN.SHIP_ADDRESS_STATE,EBS.SHIP_ADDRESS_STATE) AS SHIP_ADDRESS_STATE,
        COALESCE(MDLN.SHIP_ADDRESS_CITY,EBS.SHIP_ADDRESS_CITY) AS SHIP_ADDRESS_CITY,
        COALESCE(MDLN.BILL_ADDRESS_LINE1,EBS.BILL_ADDRESS_LINE1) AS BILL_ADDRESS_LINE1,
        COALESCE(MDLN.BILL_ADDRESS_LINE2,EBS.BILL_ADDRESS_LINE2) AS BILL_ADDRESS_LINE2,
        COALESCE(MDLN.BILL_ADDRESS_LINE3,EBS.BILL_ADDRESS_LINE3) AS BILL_ADDRESS_LINE3,
        COALESCE(MDLN.BILL_ADDRESS_LINE4,EBS.BILL_ADDRESS_LINE4) AS BILL_ADDRESS_LINE4,
        COALESCE(MDLN.BILL_ADDRESS_POSTAL_CODE,EBS.BILL_ADDRESS_POSTAL_CODE) AS BILL_ADDRESS_POSTAL_CODE,
        COALESCE(MDLN.BILL_ADDRESS_COUNTRY_CODE,EBS.BILL_ADDRESS_COUNTRY_CODE) AS BILL_ADDRESS_COUNTRY_CODE,
        COALESCE(MDLN.BILL_ADDRESS_COUNTRY_NAME,EBS.BILL_ADDRESS_COUNTRY_NAME) AS BILL_ADDRESS_COUNTRY_NAME,
        COALESCE(MDLN.BILL_ADDRESS_STATE,EBS.BILL_ADDRESS_STATE) AS BILL_ADDRESS_STATE,
        COALESCE(MDLN.BILL_ADDRESS_CITY,EBS.BILL_ADDRESS_CITY) AS BILL_ADDRESS_CITY,
        '{{V_START_DTTM}}'::TIMESTAMP_NTZ BIW_INS_DTTM ,
        '{{V_START_DTTM}}'::TIMESTAMP_NTZ BIW_UPD_DTTM ,
        {{V_BIW_BATCH_ID}}	 as BIW_BATCH_ID
    FROM CUSTOMER_EBS EBS
    FULL OUTER JOIN  CUSTOMER_MODELN MDLN
    ON EBS.CUSTOMER_CODE = MDLN.CUSTOMER_CODE
)

SELECT 
    FINAL_SQL.*,
    md5(object_construct ('col1',ERP_SITE_USE_ID::string, 'col2',ERP_STATUS::string,
    'col3',CRM_CUSTOMER_OID::string, 'col4',CRM_STATUS::string, 'col5',CUSTOMER_NAME::string, 'col6',CUSTOMER_TYPE_CODE::string,
    'col7',CUSTOMER_TYPE_DESCRIPTION::string, 'col8',CUSTOMER_SOURCE::string, 'col9',BUSINESS_CLASS_CODE::string,
    'col10',CORPORATION_CODE::string, 'col11',CORPORATION_DESCRIPTION::string, 'col12',END_CORPORATION_CODE::string,
    'col13',END_CORPORATION_DESCRIPTION::string, 'col14',SALES_ORGANIZATION_CODE::string, 'col15',END_USE_CODE::string,
    'col16',END_USE_DESCRIPTION::string, 'col17',CURRENCY_CODE::string, 'col18',ISO_CURRENCY_CODE::string, 'col19',HAS_CREDIT_HOLD::string,
    'col20',HAS_SERVICE_HOLD::string, 'col21',HAS_APPROVAL::string, 'col22',ORDER_PROCESSING_REGION_CODE::string,
    'col23',CRD_SHIP_EARLY_DAYS_QUANTITY::string, 'col24',HAS_CRD_PARTIAL::string, 'col25',SHIP_VIA_CODE::string, 'col26',HAS_SHIP_TO_CRD::string,
    'col27',SHIP_LATE_DAYS_QUANTITY::string, 'col28',BILL_CUSTOMER_CODE::string, 'col29',HANDLING_METHOD_CODE::string,
    'col30',HANDLING_METHOD_CODE_DESCRIPTION::string, 'col31',IS_EDI_CUSTOMER::string, 'col32',FINAL_DESTINATION_DESCRIPTION::string,
    'col33',BILL_COUNTRY_SOURCE_CODE::string, 'col34',FOB_OPTION_CODE::string, 'col35',PAYMENT_TERM_CODE::string,
    'col36',FINANCIAL_BANK_ID::string, 'col37',TRANSIT_DAYS_QUANTITY::string, 'col38',DELIVERY_TYPE_CODE::string,
    'col39',DATE_CODE_MAXIMUM_AGE_QUANTITY::string, 'col40',IS_CPN_REQUIRED::string, 'col41',VAT_TAX_CODE::string,
    'col42',MINIMUM_DOLLAR_VALUE_AMOUNT::string, 'col43',IS_MINIMUM_DOLLAR_VALUE_VALID::string, 'col44',CORPORATION_CATEGORY_CODE::string,
    'col45',CORPORATION_CATEGORY_DESCRIPTION::string, 'col46',CUSTOMER_ENTITY_CODE::string, 'col47',FORECAST_TYPE_CODE::string,
    'col48',IS_FORECAST_CUSTOMER::string, 'col49',FORECAST_CUSTOMER_STATUS_CODE::string, 'col50',REPLENISHMENT_CODE::string,
    'col51',SERVICE_TYPE_CODE::string, 'col52',CHANGE_ORDER_APROVAL_REQUIRED_CODE::string, 'col53',UDC_GENERIC_PROG_DESCRIPTION::string,
    'col54',CREATE_BY_ID::string, 'col55',CREATE_DTTM::string, 'col56',LAST_UPDATE_BY_ID::string, 'col57',LAST_UPDATE_DTTM::string,
    'col58',IS_DELETED::string, 'col59',QUALITY_CODE::string, 'col60',FISCAL_ACCOUNT_NUMBER::string,
    'col61',CREDIT_LIMIT_AMOUNT::string, 'col62',DIVISION::string, 'col63',SALES_STRUCTURE::string, 'col64',MARKET_SEGMENT_CODE::string,
    'col65',IS_ASSEMBLY_LOCATION::string, 'col66',OPERATING_UNIT::string, 'col67',COF_CODE::string, 'col68',COG_CODE::string,
    'col69',CUSTOMER_SHUT_DOWN_FROM_DATE::string, 'col70',CUSTOMER_SHUT_DOWN_TO_DATE::string, 'col71',FOB_OPTION_DESCRIPTION::string,
    'col72',TAX_CODE::string, 'col73',ORACLE_ORDER_TYPE::string, 'col74',ORACLE_PAYMENT_TERM::string,
    'col75',ORACLE_SITE_STATUS::string, 'col76',ORACLE_SITE_NUMBER::string, 'col77',ORACLE_SHIP_METHOD::string,
    'col78',FREE_TRADE_ZONE::string, 'col79',COLLECTOR_NAME::string, 'col80',IS_SHUTDOWN::string, 'col81',CSR_USER_ID::string,
    'col82',CSR_FIRST_NAME::string, 'col83',CSR_LAST_NAME::string, 'col84',CSR_EMAIL::string, 'col85',CSR_PHONE::string,
    'col86',CSR_CONTACT_LAST_UPDATE_BY::string, 'col87',CSR_CONTACT_CREATED_BY::string, 'col88',FQA_USER_ID::string,
    'col89',FQA_FIRST_NAME::string, 'col90',FQA_LAST_NAME::string, 'col91',FQA_EMAIL::string, 'col92',FQA_PHONE::string,
    'col93',FQA_CONTACT_LAST_UPDATE_BY::string, 'col94',FQA_CONTACT_CREATED_BY::string, 'col95',BUYER_USER_ID::string,
    'col96',BUYER_FIRST_NAME::string, 'col97',BUYER_LAST_NAME::string, 'col98',BUYER_EMAIL::string, 'col99',BUYER_PHONE::string,
    'col100',BUYER_CONTACT_LAST_UPDATE_BY::string, 'col101',BUYER_CONTACT_CREATED_BY::string, 'col102',FSE_USER_ID::string,
    'col103',FSE_FIRST_NAME::string, 'col104',FSE_LAST_NAME::string, 'col105',FSE_EMAIL::string, 'col106',FSE_PHONE::string,
    'col107',FSE_CONTACT_LAST_UPDATE_BY::string, 'col108',FSE_CONTACT_CREATED_BY::string, 'col109',SHIP_ADDRESS_LINE1::string,
    'col110',SHIP_ADDRESS_LINE2::string, 'col111',SHIP_ADDRESS_LINE3::string, 'col112',SHIP_ADDRESS_LINE4::string,
    'col113',SHIP_ADDRESS_POSTAL_CODE::string, 'col114',SHIP_ADDRESS_COUNTRY_CODE::string, 'col115',SHIP_ADDRESS_COUNTRY_NAME::string,
    'col116',SHIP_ADDRESS_STATE::string, 'col117',SHIP_ADDRESS_CITY::string, 'col118',BILL_ADDRESS_LINE1::string,
    'col119',BILL_ADDRESS_LINE2::string, 'col120',BILL_ADDRESS_LINE3::string, 'col121',BILL_ADDRESS_LINE4::string,
    'col122',BILL_ADDRESS_POSTAL_CODE::string, 'col123',BILL_ADDRESS_COUNTRY_CODE::string, 'col124',BILL_ADDRESS_COUNTRY_NAME::string,
    'col125',BILL_ADDRESS_STATE::string, 'col126',BILL_ADDRESS_CITY::string)::string )::BINARY as BIW_MD5_KEY 
FROM FINAL_SQL